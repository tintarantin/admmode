<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ADM mode: off script.</title>
  <meta name="description" content="ADM mode: off script. Игровой метод: протокол → генерация MULTIPASS → квест → билд." />

  <style>
    :root{
      --bg-0:#ffffff;
      --bg-1:#f6f1ff;
      --bg-2:#efe9ff;

      /* pearly / lilac / iridescent */
      --p-1:#c9b6ff;
      --p-2:#b9f0ff;
      --p-3:#ffd6f7;
      --p-4:#d6fff3;

      --ink:#0b0c14;
      --muted:rgba(11,12,20,.68);
      --shadow: 0 30px 80px rgba(12, 10, 30, .12);

      --radius: 28px;
      --max: 1120px;
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      color:var(--ink);
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      background:
        radial-gradient(1200px 700px at 15% 10%, rgba(185,240,255,.55), transparent 60%),
        radial-gradient(1000px 650px at 85% 20%, rgba(255,214,247,.52), transparent 62%),
        radial-gradient(900px 650px at 55% 90%, rgba(201,182,255,.50), transparent 60%),
        linear-gradient(180deg, var(--bg-0), var(--bg-1) 45%, var(--bg-2));
      overflow-x:hidden;
    }

    /* moving pearly light field */
    .aurora{
      position:fixed; inset:-40vh -40vw;
      pointer-events:none;
      filter: blur(44px) saturate(1.25);
      opacity:.62;
      background:
        conic-gradient(from 140deg,
          rgba(201,182,255,.0),
          rgba(201,182,255,.60),
          rgba(185,240,255,.58),
          rgba(255,214,247,.55),
          rgba(214,255,243,.52),
          rgba(201,182,255,.60),
          rgba(201,182,255,.0)
        );
      animation: drift 16s ease-in-out infinite;
      mix-blend-mode: soft-light;
      transform: translate3d(0,0,0);
    }
    @keyframes drift{
      0%{ transform: translate(-6vw,-3vh) rotate(0deg) scale(1); }
      50%{ transform: translate(6vw,3vh) rotate(18deg) scale(1.06); }
      100%{ transform: translate(-6vw,-3vh) rotate(0deg) scale(1); }
    }

    /* nav */
    .nav{
      position:sticky; top:0; z-index:30;
      backdrop-filter: blur(14px);
      background: linear-gradient(180deg, rgba(255,255,255,.72), rgba(255,255,255,.38));
      border-bottom: 1px solid rgba(255,255,255,.55);
    }
    .nav .wrap{
      max-width:var(--max);
      margin:0 auto;
      padding:14px 18px;
      display:flex; align-items:center; justify-content:space-between;
      gap:12px;
    }
    .brand{
      display:flex; align-items:baseline; gap:10px;
      letter-spacing:.08em;
      text-transform:uppercase;
      font-weight:900;
    }
    .brand small{
      font-weight:650;
      letter-spacing:.18em;
      opacity:.62;
      text-transform:none;
    }
    .nav a{
      color:var(--ink);
      text-decoration:none;
      font-weight:900;
      opacity:.78;
      transition: opacity .2s ease;
      letter-spacing:.10em;
      text-transform:uppercase;
      font-size:12px;
    }
    .nav a:hover{ opacity:1; }
    .nav .links{ display:flex; gap:16px; align-items:center; }

    .wrap{
      max-width:var(--max);
      margin:0 auto;
      padding:0 18px;
    }

    .hero{
      position:relative;
      padding:64px 0 22px;
      isolation:isolate;
    }

    .iridescent-bg{
      position:absolute;
      inset:-30% -20%;
      z-index:-1;
      background:
        radial-gradient(700px 420px at 20% 30%, rgba(185,240,255,.65), transparent 60%),
        radial-gradient(600px 380px at 80% 25%, rgba(255,214,247,.60), transparent 62%),
        radial-gradient(620px 420px at 55% 75%, rgba(201,182,255,.58), transparent 60%),
        radial-gradient(540px 360px at 40% 60%, rgba(214,255,243,.52), transparent 60%);
      filter: blur(22px) saturate(1.15);
      animation: pearlFlow 14s ease-in-out infinite;
      transform: translate3d(0,0,0);
      pointer-events:none;
      mix-blend-mode: soft-light;
      opacity:.9;
    }
    @keyframes pearlFlow{
      0%{ transform: translate(-2%, -2%) scale(1); }
      50%{ transform: translate(2%, 2%) scale(1.06); }
      100%{ transform: translate(-2%, -2%) scale(1); }
    }

    .title{
      font-size: clamp(40px, 5.3vw, 84px);
      line-height: .98;
      margin:0 0 14px;
      letter-spacing:-.03em;
      font-weight:950;
    }
    .shimmer{
      display:inline-block;
      background:
        linear-gradient(110deg,
          rgba(15,14,35,1) 0%,
          rgba(15,14,35,1) 28%,
          rgba(255,255,255,.98) 40%,
          rgba(15,14,35,1) 52%,
          rgba(15,14,35,1) 100%),
        conic-gradient(from 140deg,
          var(--p-1), var(--p-2), var(--p-3), var(--p-4), var(--p-1));
      -webkit-background-clip:text;
      background-clip:text;
      color:transparent;
      background-size: 220% 100%, 120% 120%;
      background-position: 0% 50%, 50% 50%;
      filter: drop-shadow(0 10px 26px rgba(12,10,30,.12));
      animation: shine 3.8s ease-in-out infinite;
    }
    @keyframes shine{
      0%{ background-position: 0% 50%, 50% 50%; }
      55%{ background-position: 100% 50%, 50% 50%; }
      100%{ background-position: 0% 50%, 50% 50%; }
    }

    .lead{
      max-width: 900px;
      font-size: clamp(16px, 1.55vw, 19px);
      line-height:1.6;
      color:var(--muted);
      margin: 0 0 14px;
      font-weight:700;
    }

    .methodMini{
      max-width: 920px;
      margin: 0 0 18px;
      display:grid;
      gap:10px;
    }
    .miniRow{
      display:flex; gap:10px; flex-wrap:wrap; align-items:center;
    }
    .miniPill{
      padding:10px 12px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.75);
      background: linear-gradient(180deg, rgba(255,255,255,.78), rgba(255,255,255,.44));
      backdrop-filter: blur(14px);
      box-shadow: 0 14px 44px rgba(12,10,30,.10);
      font-weight:950;
      letter-spacing:.12em;
      text-transform:uppercase;
      font-size:11px;
      opacity:.92;
      user-select:none;
    }
    .miniText{
      color: rgba(11,12,20,.72);
      font-weight:750;
      line-height:1.5;
    }

    .chips{
      display:flex; flex-wrap:wrap; gap:10px;
      margin: 0 0 18px;
    }
    .chip{
      padding:10px 12px;
      border-radius: 999px;
      border:1px solid rgba(255,255,255,.75);
      background: linear-gradient(180deg, rgba(255,255,255,.78), rgba(255,255,255,.44));
      backdrop-filter: blur(14px);
      box-shadow: 0 14px 44px rgba(12,10,30,.10);
      font-weight:900;
      letter-spacing:.10em;
      text-transform:uppercase;
      color: rgba(11,12,20,.86);
      position:relative;
      overflow:hidden;
      user-select:none;
      font-size:12px;
    }
    .chip::after{
      content:"";
      position:absolute; inset:-2px -30%;
      background: linear-gradient(90deg, transparent, rgba(185,240,255,.55), rgba(255,214,247,.55), transparent);
      transform: translateX(-40%);
      animation: chipshine 3.2s ease-in-out infinite;
      opacity:.9;
      mix-blend-mode: soft-light;
    }
    @keyframes chipshine{
      0%{ transform: translateX(-60%); }
      55%{ transform: translateX(60%); }
      100%{ transform: translateX(-60%); }
    }

    .ctaRow{
      display:flex; gap:12px; flex-wrap:wrap;
      align-items:center;
      margin: 12px 0 10px;
    }
    .btn{
      display:inline-flex; align-items:center; gap:10px;
      padding: 14px 16px;
      border-radius: 16px;
      border:1px solid rgba(255,255,255,.75);
      background: linear-gradient(180deg, rgba(255,255,255,.78), rgba(255,255,255,.44));
      backdrop-filter: blur(14px);
      box-shadow: var(--shadow);
      color:rgba(11,12,20,.9);
      text-decoration:none;
      font-weight:950;
      letter-spacing:.06em;
      transition: transform .15s ease, box-shadow .2s ease, opacity .2s ease;
      cursor:pointer;
      position:relative;
      overflow:hidden;
      user-select:none;
      text-transform:uppercase;
      font-size:12px;
    }
    .btn:hover{ transform: translateY(-2px); box-shadow: 0 40px 100px rgba(12,10,30,.14); }
    .btn.primary::before{
      content:"";
      position:absolute; inset:-3px;
      background: conic-gradient(from 150deg,
        rgba(201,182,255,.75),
        rgba(185,240,255,.75),
        rgba(255,214,247,.70),
        rgba(214,255,243,.65),
        rgba(201,182,255,.75)
      );
      filter: blur(14px);
      opacity:.55;
      animation: halo 4.8s ease-in-out infinite;
      pointer-events:none;
    }
    @keyframes halo{
      0%{ transform: rotate(0deg) scale(1); }
      50%{ transform: rotate(18deg) scale(1.06); }
      100%{ transform: rotate(0deg) scale(1); }
    }
    .btn span{ position:relative; z-index:1; }
    .btn.ghost{ opacity:.78; }
    .btn.ghost:hover{ opacity:1; }
    .btn:disabled{
      opacity:.45;
      cursor:not-allowed;
      transform:none !important;
    }

    /* layout */
    .grid{
      display:grid;
      grid-template-columns: 1.1fr .9fr;
      gap:18px;
      margin: 26px 0 26px;
    }
    @media (max-width: 940px){
      .grid{ grid-template-columns: 1fr; }
    }

    .card{
      border-radius: var(--radius);
      border:1px solid rgba(255,255,255,.70);
      background: linear-gradient(180deg, rgba(255,255,255,.74), rgba(255,255,255,.36));
      backdrop-filter: blur(16px);
      box-shadow: var(--shadow);
      overflow:hidden;
      position:relative;
    }
    .card::before{
      content:"";
      position:absolute; inset:-2px;
      background:
        conic-gradient(from 140deg,
          rgba(201,182,255,.0),
          rgba(201,182,255,.65),
          rgba(185,240,255,.62),
          rgba(255,214,247,.58),
          rgba(214,255,243,.50),
          rgba(201,182,255,.65),
          rgba(201,182,255,.0)
        );
      filter: blur(14px);
      opacity:.52;
      animation: borderFlow 7.2s ease-in-out infinite;
      pointer-events:none;
    }
    @keyframes borderFlow{
      0%{ transform: rotate(0deg); }
      50%{ transform: rotate(26deg); }
      100%{ transform: rotate(0deg); }
    }

    .card > .inner{
      position:relative;
      padding: 22px 22px 18px;
      z-index:1;
    }
    .h2{
      margin:0 0 10px;
      font-size: 12px;
      letter-spacing:.20em;
      text-transform:uppercase;
      opacity:.78;
      font-weight:950;
    }
    .manifest{
      margin: 0;
      font-size: clamp(18px, 1.85vw, 22px);
      line-height: 1.55;
      letter-spacing: -.01em;
      color: rgba(11,12,20,.92);
      font-weight:750;
    }

    .list{
      margin:14px 0 0;
      padding:0;
      list-style:none;
      display:grid;
      gap:12px;
    }
    .item{
      padding:14px 14px;
      border-radius: 18px;
      border:1px solid rgba(255,255,255,.68);
      background: linear-gradient(180deg, rgba(255,255,255,.68), rgba(255,255,255,.35));
      position:relative;
      overflow:hidden;
    }
    .item::after{
      content:"";
      position:absolute; inset:-40% -20%;
      background:
        radial-gradient(400px 240px at 20% 40%, rgba(185,240,255,.55), transparent 60%),
        radial-gradient(380px 220px at 80% 60%, rgba(255,214,247,.50), transparent 62%);
      opacity:.55;
      filter: blur(18px);
      transform: translate3d(0,0,0);
      animation: mist 9s ease-in-out infinite;
      pointer-events:none;
      mix-blend-mode: soft-light;
    }
    @keyframes mist{
      0%{ transform: translate(-2%, -2%) scale(1); }
      50%{ transform: translate(2%, 2%) scale(1.04); }
      100%{ transform: translate(-2%, -2%) scale(1); }
    }

    .item b{
      display:flex; align-items:center; justify-content:space-between;
      font-size:12px;
      letter-spacing:.18em;
      text-transform:uppercase;
      opacity:.70;
      margin-bottom:6px;
      font-weight:950;
    }
    .tag{
      font-size:11px;
      letter-spacing:.18em;
      padding:6px 10px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.65);
      background: linear-gradient(180deg, rgba(255,255,255,.66), rgba(255,255,255,.32));
      opacity:.92;
      text-transform:uppercase;
      font-weight:900;
    }
    .item p{ margin:0; color:var(--muted); line-height:1.45; font-weight:650; }

    /* reveal */
    .reveal{ opacity:0; transform: translateY(16px); transition: opacity .7s ease, transform .7s ease; }
    .reveal.on{ opacity:1; transform: translateY(0); }

    /* ---------- PROTOCOL SIGNING ---------- */
    .protocolPanel{ display:grid; gap:12px; }
    .console{
      border-radius: 20px;
      border:1px solid rgba(255,255,255,.70);
      background: linear-gradient(180deg, rgba(255,255,255,.70), rgba(255,255,255,.32));
      padding: 14px 14px;
      position:relative;
      overflow:hidden;
    }
    .console::before{
      content:"";
      position:absolute; inset:-1px;
      background: linear-gradient(90deg,
        transparent 0%,
        rgba(185,240,255,.25) 35%,
        rgba(255,214,247,.22) 55%,
        transparent 100%);
      transform: translateX(-60%);
      animation: scan 4.2s ease-in-out infinite;
      opacity:.55;
      mix-blend-mode: soft-light;
      pointer-events:none;
    }
    @keyframes scan{
      0%{ transform: translateX(-60%); }
      55%{ transform: translateX(60%); }
      100%{ transform: translateX(-60%); }
    }
    .console .row{ display:flex; gap:10px; align-items:center; justify-content:space-between; flex-wrap:wrap; }
    .kv{
      display:flex; gap:10px; align-items:center;
      font-weight:950;
      letter-spacing:.18em;
      text-transform:uppercase;
      font-size:12px;
      opacity:.78;
    }
    .pill{
      padding:8px 10px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.65);
      background: linear-gradient(180deg, rgba(255,255,255,.66), rgba(255,255,255,.30));
      font-weight:950;
      letter-spacing:.16em;
      text-transform:uppercase;
      font-size:11px;
      opacity:.95;
    }
    .statusDot{
      width:10px;height:10px;border-radius:999px;
      background: rgba(11,12,20,.35);
      box-shadow: 0 0 0 6px rgba(11,12,20,.06);
    }
    .statusDot.on{
      background: rgba(11,12,20,.78);
      box-shadow: 0 0 0 6px rgba(185,240,255,.18);
    }

    .signatureBox{
      border-radius: 22px;
      border: 1px dashed rgba(11,12,20,.22);
      background: rgba(255,255,255,.55);
      padding: 14px;
      position:relative;
      overflow:hidden;
    }
    .sigTop{
      display:flex; align-items:center; justify-content:space-between; gap:10px; flex-wrap:wrap;
      margin-bottom:10px;
    }
    .sigLabel{
      font-weight:950;
      letter-spacing:.16em;
      text-transform:uppercase;
      font-size:12px;
      opacity:.78;
    }
    .sigHint{
      color:var(--muted);
      font-weight:650;
      font-size:13px;
    }
    canvas#sig{
      width:100%;
      height:160px;
      display:block;
      border-radius: 16px;
      background: linear-gradient(180deg, rgba(255,255,255,.65), rgba(255,255,255,.30));
      border:1px solid rgba(255,255,255,.65);
      touch-action:none;
    }

    .stamp{
      position:absolute;
      right:16px;
      bottom:16px;
      transform: rotate(-12deg) scale(.9);
      padding:10px 12px;
      border-radius: 16px;
      border: 2px solid rgba(11,12,20,.75);
      background: rgba(255,255,255,.7);
      font-weight:1000;
      letter-spacing:.18em;
      text-transform:uppercase;
      opacity:0;
      pointer-events:none;
      filter: drop-shadow(0 18px 40px rgba(12,10,30,.14));
    }
    .stamp.on{
      opacity:1;
      animation: stampIn .35s ease-out both, glitch .9s ease-in-out .25s 2;
    }
    @keyframes stampIn{
      0%{ transform: rotate(-18deg) scale(1.25); opacity:0; }
      100%{ transform: rotate(-12deg) scale(.92); opacity:1; }
    }
    @keyframes glitch{
      0%{ transform: rotate(-12deg) translate(0,0) scale(.92); }
      20%{ transform: rotate(-12deg) translate(-2px,1px) scale(.92); }
      40%{ transform: rotate(-12deg) translate(2px,-1px) scale(.92); }
      60%{ transform: rotate(-12deg) translate(-1px,-2px) scale(.92); }
      80%{ transform: rotate(-12deg) translate(1px,2px) scale(.92); }
      100%{ transform: rotate(-12deg) translate(0,0) scale(.92); }
    }

    .locked{
      opacity:.35;
      filter: blur(.2px);
      pointer-events:none;
      transition: opacity .35s ease;
    }
    .locked.unlock{
      opacity:1;
      filter:none;
      pointer-events:auto;
    }

    /* ---------- QUEST + METERS ---------- */
    .questTop{
      display:flex; gap:10px; align-items:center; justify-content:space-between; flex-wrap:wrap;
      margin-bottom:10px;
    }
    .meterRow{
      display:flex; gap:10px; flex-wrap:wrap; align-items:center;
    }
    .meter{
      display:flex; align-items:center; gap:8px;
      padding:8px 10px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.65);
      background: linear-gradient(180deg, rgba(255,255,255,.66), rgba(255,255,255,.32));
      font-weight:950;
      letter-spacing:.16em;
      text-transform:uppercase;
      font-size:11px;
      opacity:.95;
      user-select:none;
    }
    .bar{
      width:140px; height:8px;
      border-radius:999px;
      background: rgba(11,12,20,.10);
      overflow:hidden;
      border:1px solid rgba(255,255,255,.55);
    }
    .fill{
      height:100%;
      width:0%;
      border-radius:999px;
      background: linear-gradient(90deg, rgba(201,182,255,.9), rgba(185,240,255,.85), rgba(255,214,247,.85));
      transition: width .45s ease;
    }

    .questCard{
      border-radius: 22px;
      border:1px solid rgba(255,255,255,.70);
      background: linear-gradient(180deg, rgba(255,255,255,.72), rgba(255,255,255,.34));
      padding: 14px;
      position:relative;
      overflow:hidden;
    }
    .questCard::before{
      content:"";
      position:absolute; inset:-1px;
      background: radial-gradient(600px 240px at 20% 30%, rgba(185,240,255,.22), transparent 60%),
                  radial-gradient(560px 240px at 80% 60%, rgba(255,214,247,.18), transparent 62%);
      filter: blur(18px);
      opacity:.8;
      pointer-events:none;
      mix-blend-mode: soft-light;
    }
    .questCard > *{ position:relative; z-index:1; }

    .questHeader{
      display:flex; align-items:flex-start; justify-content:space-between; gap:10px; flex-wrap:wrap;
      margin-bottom:10px;
    }
    .qTitle{
      font-weight:1000;
      letter-spacing:.18em;
      text-transform:uppercase;
      font-size:12px;
      opacity:.78;
    }
    .qStep{
      font-weight:1000;
      letter-spacing:.18em;
      text-transform:uppercase;
      font-size:11px;
      padding:6px 10px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.65);
      background: linear-gradient(180deg, rgba(255,255,255,.66), rgba(255,255,255,.30));
      opacity:.95;
      user-select:none;
    }
    .qText{
      margin:0 0 12px;
      font-size: clamp(16px, 1.5vw, 19px);
      line-height:1.45;
      color: rgba(11,12,20,.90);
      font-weight:800;
      letter-spacing:-.01em;
    }

    .choices{
      display:grid;
      gap:10px;
      margin: 10px 0 0;
    }
    .choice{
      text-align:left;
      padding:12px 12px;
      border-radius: 18px;
      border:1px solid rgba(255,255,255,.70);
      background: linear-gradient(180deg, rgba(255,255,255,.74), rgba(255,255,255,.34));
      cursor:pointer;
      font-weight:900;
      letter-spacing:.02em;
      color: rgba(11,12,20,.88);
      transition: transform .12s ease, box-shadow .2s ease, opacity .2s ease;
      position:relative;
      overflow:hidden;
      user-select:none;
    }
    .choice:hover{
      transform: translateY(-1px);
      box-shadow: 0 22px 60px rgba(12,10,30,.12);
    }
    .choice:active{ transform: translateY(0px) scale(.99); }
    .choice::after{
      content:"";
      position:absolute; inset:-2px -35%;
      background: linear-gradient(90deg, transparent, rgba(185,240,255,.28), rgba(255,214,247,.25), transparent);
      transform: translateX(-55%);
      animation: choiceScan 3.6s ease-in-out infinite;
      opacity:.65;
      pointer-events:none;
      mix-blend-mode: soft-light;
    }
    @keyframes choiceScan{
      0%{ transform: translateX(-55%); }
      55%{ transform: translateX(55%); }
      100%{ transform: translateX(-55%); }
    }
    .choice small{
      display:block;
      margin-top:6px;
      color: var(--muted);
      font-weight:750;
      letter-spacing:0;
      text-transform:none;
      line-height:1.35;
    }

    .result{
      margin-top:12px;
      border-radius: 18px;
      border:1px solid rgba(255,255,255,.65);
      background: rgba(255,255,255,.55);
      padding: 12px;
      color: rgba(11,12,20,.88);
      font-weight:800;
      line-height:1.45;
      display:none;
    }
    .result.on{ display:block; animation: pop .25s ease-out both; }
    @keyframes pop{
      from{ transform: translateY(6px); opacity:0; }
      to{ transform: translateY(0); opacity:1; }
    }

    .nextRow{
      display:flex; gap:12px; flex-wrap:wrap; align-items:center;
      margin-top:12px;
    }
    .tiny{
      font-size:12px;
      letter-spacing:.14em;
      text-transform:uppercase;
      opacity:.7;
      font-weight:950;
    }

    /* ---------- MULTIPASS (output) ---------- */
    .formGrid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:10px;
    }
    @media (max-width: 940px){
      .formGrid{ grid-template-columns:1fr; }
    }
    .field{
      display:grid;
      gap:6px;
    }
    .field span{
      font-size:12px;
      letter-spacing:.18em;
      text-transform:uppercase;
      opacity:.72;
      font-weight:950;
    }
    .field input, .field select{
      padding:12px 12px;
      border-radius: 16px;
      border:1px solid rgba(255,255,255,.70);
      background: linear-gradient(180deg, rgba(255,255,255,.78), rgba(255,255,255,.34));
      font-weight:900;
      outline:none;
      color: rgba(11,12,20,.88);
    }
    .field input::placeholder{ color: rgba(11,12,20,.45); }

    .termList{
      list-style:none;
      margin:0;
      padding:0;
      display:grid;
      gap:10px;
    }
    .termList li{
      padding:12px 12px;
      border-radius:18px;
      border:1px solid rgba(255,255,255,.68);
      background: linear-gradient(180deg, rgba(255,255,255,.70), rgba(255,255,255,.34));
      font-weight:900;
      letter-spacing:.06em;
      text-transform:uppercase;
      font-size:12px;
    }
    .termList li small{
      display:block;
      margin-top:6px;
      color: rgba(11,12,20,.62);
      font-weight:750;
      letter-spacing:0;
      text-transform:none;
      line-height:1.35;
    }

    .multipass{
      border-radius: 22px;
      border:1px solid rgba(255,255,255,.70);
      background: linear-gradient(180deg, rgba(255,255,255,.72), rgba(255,255,255,.30));
      padding: 14px;
      position:relative;
      overflow:hidden;
    }
    .multipass::before{
      content:"";
      position:absolute; inset:-2px;
      background:
        linear-gradient(90deg,
          transparent 0%,
          rgba(185,240,255,.22) 35%,
          rgba(255,214,247,.20) 55%,
          transparent 100%);
      transform: translateX(-60%);
      animation: multipassScan 3.6s ease-in-out infinite;
      opacity:.7;
      mix-blend-mode: soft-light;
      pointer-events:none;
    }
    @keyframes multipassScan{
      0%{ transform: translateX(-60%); }
      55%{ transform: translateX(60%); }
      100%{ transform: translateX(-60%); }
    }
    .multipassTop{
      display:flex;
      gap:10px;
      justify-content:space-between;
      align-items:center;
      flex-wrap:wrap;
      margin-bottom:12px;
      position:relative;
      z-index:1;
    }
    .multipassGrid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:12px;
      position:relative;
      z-index:1;
    }
    @media (max-width: 940px){
      .multipassGrid{ grid-template-columns:1fr; }
    }
    .mBlock{
      border-radius: 18px;
      border:1px solid rgba(255,255,255,.68);
      background: rgba(255,255,255,.55);
      padding: 12px;
    }
    .mBlock b{
      display:block;
      font-size:12px;
      letter-spacing:.18em;
      text-transform:uppercase;
      opacity:.72;
      margin-bottom:8px;
      font-weight:1000;
    }
    .mRows{ display:grid; gap:8px; }
    .mRow{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      padding:10px 10px;
      border-radius: 16px;
      border:1px solid rgba(255,255,255,.65);
      background: linear-gradient(180deg, rgba(255,255,255,.70), rgba(255,255,255,.32));
      font-weight:900;
    }
    .mRow span{ opacity:.78; letter-spacing:.14em; text-transform:uppercase; font-size:11px; font-weight:950; }
    .mRow i{ font-style:normal; font-weight:950; }
    .mText{
      color: rgba(11,12,20,.78);
      font-weight:800;
      line-height:1.45;
    }

    footer{
      padding: 26px 0 40px;
      color: rgba(11,12,20,.55);
      text-align:center;
      font-weight:900;
      letter-spacing:.10em;
      text-transform:uppercase;
      font-size:12px;
    }
  </style>
</head>

<body>
  <div class="aurora" aria-hidden="true"></div>

  <header class="nav">
    <div class="wrap">
      <div class="brand">
        <div>ADM mode: <span style="opacity:.88">off script.</span></div>
        <small>game protocol</small>
      </div>

      <nav class="links">
        <a href="#manifest">manifest</a>
        <a href="#protocol">protocol</a>
        <a href="#generator">multipass</a>
        <a href="#quest">quest</a>
      </nav>
    </div>
  </header>

  <main class="wrap">
    <section class="hero">
      <div class="iridescent-bg" aria-hidden="true"></div>

      <h1 class="title">
        <span class="shimmer">adm mode:</span><br/>
        <span class="shimmer">off script.</span>
      </h1>

      <!-- кратко и жёстко: что это за метод -->
      <p class="lead reveal">
        это не «саморазвитие». это <b>игровой метод перепрошивки</b>:
        <b>подписываешь протокол</b> → <b>генерируешь MULTIPASS</b> по дате рождения →
        <b>проходишь квест</b> → <b>собираешь билд</b> и фиксируешь правила.
      </p>

      <div class="methodMini reveal">
        <div class="miniRow">
          <div class="miniPill">engine</div>
          <div class="miniText">
            <b>ADM CORE ENGINE</b> объединяет разные школы в один интерфейс и переводит всё на язык игры:
            STAR MAP / BUILD BLUEPRINT / DESTINY GRID / ARCHETYPE LOADOUT / BEHAVIOR SCRIPT / PROBABILITY FIELD.
          </div>
        </div>
        <div class="miniRow">
          <div class="miniPill">output</div>
          <div class="miniText">
            ты получаешь <b>MULTIPASS</b>, шкалу заполненности билда и маршрут миссий на 7 дней.
          </div>
        </div>
      </div>

      <div class="chips reveal" aria-label="tags">
        <div class="chip">tutorial: skipped</div>
        <div class="chip">anti-sys</div>
        <div class="chip">protocol</div>
        <div class="chip">multipass</div>
        <div class="chip">quest</div>
      </div>

      <div class="ctaRow reveal">
        <a class="btn primary" href="#protocol"><span>sign protocol →</span></a>
        <a class="btn ghost" href="#generator"><span>generate multipass</span></a>
        <a class="btn ghost" href="#quest"><span>start quest</span></a>
      </div>
    </section>

    <!-- MANIFEST (SHORTENED AS REQUESTED) -->
    <section class="grid" id="manifest">
      <article class="card reveal">
        <div class="inner">
          <div class="h2">manifest</div>
          <p class="manifest">
            Если система закрывает двери — я становлюсь дверью.<br/>
            Если система ставит границы — я становлюсь линией разрыва.<br/><br/>
            Я не прошу разрешения.<br/>
            Я создаю протокол.
          </p>
        </div>
      </article>

      <aside class="card reveal">
        <div class="inner">
          <div class="h2">game rules</div>
          <ul class="list">
            <li class="item">
              <b>role <span class="tag">you = admin</span></b>
              <p>ты не NPC. ты владелец протокола. ты выбираешь правила.</p>
            </li>
            <li class="item">
              <b>enemy <span class="tag">system</span></b>
              <p>система — окружение. ты не обязан(а) ей соответствовать.</p>
            </li>
            <li class="item">
              <b>currency <span class="tag">pressure → fuel</span></b>
              <p>давление — ресурс. при правильной конвертации оно строит броню.</p>
            </li>
            <li class="item">
              <b>gates <span class="tag">protocol → multipass</span></b>
              <p>сначала подпись, потом генерация MULTIPASS, потом квест.</p>
            </li>
          </ul>
        </div>
      </aside>
    </section>

    <!-- PROTOCOL SIGNING -->
    <section class="card reveal" id="protocol" style="margin-bottom:18px;">
      <div class="inner">
        <div class="h2">protocol signing</div>

        <div class="protocolPanel">
          <div class="console">
            <div class="row">
              <div class="kv"><span class="statusDot" id="dot"></span> access: <span id="accessTxt">locked</span></div>
              <div class="pill">adm mode: off script</div>
            </div>
            <div style="margin-top:8px; color:var(--muted); font-weight:700; line-height:1.5;">
              нарисуй подпись → нажми <b>confirm</b> → откроются MULTIPASS генератор и квест.
            </div>
          </div>

          <div class="signatureBox">
            <div class="sigTop">
              <div class="sigLabel">signature input</div>
              <div class="sigHint">touch / mouse</div>
            </div>

            <canvas id="sig"></canvas>
            <div class="stamp" id="stamp">signed</div>

            <div class="ctaRow" style="margin:12px 0 0;">
              <button class="btn" id="clearBtn" type="button"><span>clear</span></button>
              <button class="btn primary" id="confirmBtn" type="button"><span>confirm</span></button>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- MULTIPASS GENERATOR (CALENDAR + GENERATE BUTTON) -->
    <section class="card reveal locked" id="generator" style="margin-bottom:18px;">
      <div class="inner">
        <div class="questTop">
          <div>
            <div class="h2">multipass generator</div>
            <div class="tiny">date + time + city → generate multipass → build meter fills.</div>
          </div>

          <div class="meterRow">
            <div class="meter">engine: <span id="engineStatus">standby</span></div>
            <div class="meter">build meter
              <span class="bar"><span class="fill" id="buildFill"></span></span>
              <span id="buildPct">0%</span>
            </div>
          </div>
        </div>

        <div class="grid" style="margin:0; grid-template-columns: 1fr 1fr;">
          <div class="questCard">
            <div class="questHeader">
              <div class="qTitle">input panel</div>
              <div class="qStep">birth data</div>
            </div>

            <div class="formGrid">
              <label class="field">
                <span>date (calendar)</span>
                <input id="birthDate" type="date" />
              </label>

              <label class="field">
                <span>time</span>
                <input id="birthTime" type="time" value="01:30" />
              </label>

              <label class="field" style="grid-column: 1 / -1;">
                <span>location (city)</span>
                <input id="birthCity" type="text" placeholder="например: Нальчик, Россия" />
              </label>

              <label class="field" style="grid-column: 1 / -1;">
                <span>scan mode</span>
                <select id="engineMode">
                  <option value="strict">strict scan</option>
                  <option value="myth">myth scan</option>
                  <option value="hard">hardcore off-script</option>
                </select>
              </label>
            </div>

            <div class="ctaRow" style="margin:12px 0 0;">
              <button class="btn" id="prefillMe" type="button"><span>load my birth data</span></button>
              <button class="btn primary" id="genMultipassBtn" type="button"><span>generate multipass</span></button>
            </div>

            <div class="result" id="genLog"></div>
          </div>

          <div class="questCard">
            <div class="questHeader">
              <div class="qTitle">translator</div>
              <div class="qStep">system → game</div>
            </div>

            <ul class="termList" id="termList"></ul>

            <div class="tiny" style="margin-top:10px;">
              “PROBABILITY FIELD” — метафора языка выбора, не научное обещание.
            </div>
          </div>
        </div>

        <!-- MULTIPASS OUTPUT -->
        <div class="questCard" style="margin-top:14px;">
          <div class="questHeader">
            <div class="qTitle">multipass • adm id</div>
            <div class="qStep" id="multipassStatus">status: not generated</div>
          </div>

          <div class="multipass locked" id="multipass">
            <div class="multipassTop">
              <div class="pill" id="mpId">ID: ADM-0000</div>
              <div class="pill" id="mpTag">clearance: unknown</div>
            </div>

            <div class="multipassGrid">
              <div class="mBlock">
                <b>core stats</b>
                <div class="mRows" id="statRows"></div>
              </div>

              <div class="mBlock">
                <b>archetype loadout</b>
                <div class="mText" id="archetypeText"></div>
              </div>

              <div class="mBlock">
                <b>main quest</b>
                <div class="mText" id="mainQuestText"></div>
              </div>

              <div class="mBlock">
                <b>quest route (7 days)</b>
                <div class="mRows" id="routeRows"></div>
              </div>
            </div>
          </div>
        </div>

      </div>
    </section>

    <!-- QUEST (LOCKED UNTIL SIGNED) -->
    <section class="card locked reveal" id="quest" style="margin-bottom:18px;">
      <div class="inner">
        <div class="questTop">
          <div>
            <div class="h2">quest: deep scan</div>
            <div class="tiny">выбирай ответы → билд собирается → шкала заполненности растёт.</div>
          </div>

          <div class="meterRow">
            <div class="meter">progress
              <span class="bar"><span class="fill" id="progressFill"></span></span>
              <span id="questPct">0%</span>
            </div>
            <div class="meter">build: <span id="buildName">unknown</span></div>
          </div>
        </div>

        <div class="questCard">
          <div class="questHeader">
            <div class="qTitle" id="qTitle">mission</div>
            <div class="qStep" id="qStep">step 1/5</div>
          </div>

          <p class="qText" id="qText">...</p>

          <div class="choices" id="choices"></div>

          <div class="result" id="result"></div>

          <div class="nextRow">
            <button class="btn ghost" id="backBtn" type="button"><span>back</span></button>
            <button class="btn primary" id="nextBtn" type="button"><span>next</span></button>
            <span class="tiny" id="hint">choose to unlock next</span>
          </div>
        </div>
      </div>
    </section>

    <footer class="reveal">
      ADM MODE: OFF SCRIPT • PROTOCOL → MULTIPASS → QUEST → BUILD
    </footer>
  </main>

  <script>
    // reveal on scroll
    const els = Array.from(document.querySelectorAll('.reveal'));
    const io = new IntersectionObserver((entries) => {
      entries.forEach(e => { if(e.isIntersecting) e.target.classList.add('on'); });
    }, { threshold: 0.12 });
    els.forEach(el => io.observe(el));

    // ---------- SIGNATURE CANVAS ----------
    const canvas = document.getElementById('sig');
    const ctx = canvas.getContext('2d');

    function resizeCanvas(){
      const rect = canvas.getBoundingClientRect();
      const dpr = Math.max(1, window.devicePixelRatio || 1);
      canvas.width = Math.floor(rect.width * dpr);
      canvas.height = Math.floor(rect.height * dpr);
      ctx.setTransform(dpr,0,0,dpr,0,0);

      ctx.lineCap = 'round';
      ctx.lineJoin = 'round';
      ctx.lineWidth = 2.6;
      ctx.strokeStyle = 'rgba(11,12,20,.78)';

      ctx.clearRect(0,0,rect.width,rect.height);

      // guide line
      ctx.strokeStyle = 'rgba(11,12,20,.10)';
      ctx.lineWidth = 1;
      ctx.beginPath();
      ctx.moveTo(14, rect.height - 32);
      ctx.lineTo(rect.width - 14, rect.height - 32);
      ctx.stroke();

      ctx.strokeStyle = 'rgba(11,12,20,.78)';
      ctx.lineWidth = 2.6;
    }
    window.addEventListener('resize', resizeCanvas, {passive:true});
    requestAnimationFrame(resizeCanvas);

    let drawing = false;
    let hasInk = false;

    function getPos(e){
      const rect = canvas.getBoundingClientRect();
      const touch = e.touches && e.touches[0];
      const clientX = touch ? touch.clientX : e.clientX;
      const clientY = touch ? touch.clientY : e.clientY;
      return { x: clientX - rect.left, y: clientY - rect.top };
    }

    function start(e){
      drawing = true;
      const p = getPos(e);
      ctx.beginPath();
      ctx.moveTo(p.x, p.y);
      hasInk = true;
      e.preventDefault?.();
    }
    function move(e){
      if(!drawing) return;
      const p = getPos(e);
      ctx.lineTo(p.x, p.y);
      ctx.stroke();
      e.preventDefault?.();
    }
    function end(){ drawing = false; }

    canvas.addEventListener('mousedown', start);
    canvas.addEventListener('mousemove', move);
    window.addEventListener('mouseup', end);

    canvas.addEventListener('touchstart', start, {passive:false});
    canvas.addEventListener('touchmove', move, {passive:false});
    window.addEventListener('touchend', end);

    const clearBtn = document.getElementById('clearBtn');
    const confirmBtn = document.getElementById('confirmBtn');
    const stamp = document.getElementById('stamp');
    const dot = document.getElementById('dot');
    const accessTxt = document.getElementById('accessTxt');

    const questSection = document.getElementById('quest');
    const generatorSection = document.getElementById('generator');
    const engineStatus = document.getElementById('engineStatus');

    function lockSection(section, lock){
      if(!section) return;
      if(lock){
        section.classList.add('locked');
        section.classList.remove('unlock');
      }else{
        section.classList.add('unlock');
        section.classList.remove('locked');
      }
    }
    lockSection(questSection, true);
    lockSection(generatorSection, true);

    function onProtocolSigned(){
      lockSection(generatorSection, false);
      lockSection(questSection, false);
      if(engineStatus) engineStatus.textContent = "online";
    }

    clearBtn.addEventListener('click', ()=>{
      resizeCanvas();
      stamp.classList.remove('on');
      dot.classList.remove('on');
      accessTxt.textContent = 'locked';
      lockSection(generatorSection, true);
      lockSection(questSection, true);
      if(engineStatus) engineStatus.textContent = "standby";
      hasInk = false;
    });

    confirmBtn.addEventListener('click', ()=>{
      if(!hasInk){
        confirmBtn.animate([
          { transform:'translateX(0)' },
          { transform:'translateX(-3px)' },
          { transform:'translateX(3px)' },
          { transform:'translateX(0)' },
        ], { duration: 240, iterations: 1 });
        return;
      }
      stamp.classList.add('on');
      dot.classList.add('on');
      accessTxt.textContent = 'granted';
      onProtocolSigned();

      setTimeout(()=> generatorSection.scrollIntoView({ behavior:'smooth', block:'start' }), 420);
    });

    // ---------- TERM TRANSLATOR ----------
    const TERM_MAP = [
      { sys:"натальная карта / астрология", game:"STAR MAP / SKY SEED", note:"ритмы, сезоны силы, окна действия" },
      { sys:"дизайн человека", game:"BUILD BLUEPRINT", note:"как работает энергия: тип движка и стиль действий" },
      { sys:"матрица судьбы", game:"DESTINY GRID", note:"повторяющиеся уровни и паттерны сюжета" },
      { sys:"нумерология", game:"CODE NUMBERS", note:"числовые ключи входа и триггеры решений" },
      { sys:"архетипы Юнга", game:"ARCHETYPE LOADOUT", note:"ролевая матрица: маски и управление тенью" },
      { sys:"психология", game:"BEHAVIOR SCRIPT", note:"скрипты, триггеры, петли" },
      { sys:"эзотерика", game:"HIDDEN LAYER", note:"символика, интуиция, тень" },
      { sys:"квантовый язык (метафора)", game:"PROBABILITY FIELD", note:"поле вероятностей: выбор меняет траекторию" },
    ];
    const termList = document.getElementById('termList');
    if(termList){
      termList.innerHTML = TERM_MAP.map(t =>
        `<li>${t.game}<small>${t.sys} → ${t.note}</small></li>`
      ).join("");
    }

    // ---------- MULTIPASS GENERATOR ----------
    const birthDate = document.getElementById('birthDate');
    const birthTime = document.getElementById('birthTime');
    const birthCity = document.getElementById('birthCity');
    const engineMode = document.getElementById('engineMode');

    const prefillMe = document.getElementById('prefillMe');
    const genBtn = document.getElementById('genMultipassBtn');
    const genLog = document.getElementById('genLog');

    const buildFill = document.getElementById('buildFill');
    const buildPct = document.getElementById('buildPct');

    const multipass = document.getElementById('multipass');
    const multipassStatus = document.getElementById('multipassStatus');
    const mpId = document.getElementById('mpId');
    const mpTag = document.getElementById('mpTag');

    const statRows = document.getElementById('statRows');
    const archetypeText = document.getElementById('archetypeText');
    const mainQuestText = document.getElementById('mainQuestText');
    const routeRows = document.getElementById('routeRows');

    function showLog(text){
      if(!genLog) return;
      genLog.textContent = text;
      genLog.classList.add('on');
    }

    // load your birth data
    prefillMe?.addEventListener('click', ()=>{
      if(birthDate) birthDate.value = "1996-08-01";
      if(birthTime) birthTime.value = "01:30";
      if(birthCity) birthCity.value = "Нальчик, Россия";
      showLog("SYSTEM: template loaded (your birth data).");
    });

    function sumDigits(str){
      return (str || "").replace(/\D/g,'').split('').reduce((a,c)=>a + (c.charCodeAt(0)-48), 0);
    }
    function clamp(n,min,max){ return Math.max(min, Math.min(max,n)); }

    function computeBuildMeter(stats){
      // 4 stats, each 1..15 => max 60
      const total = stats.autonomy + stats.rage + stats.clarity + stats.armor;
      const pct = Math.round((total / 60) * 100);
      return clamp(pct, 0, 100);
    }

    function generateMultipass({dateStr, timeStr, cityStr, mode}){
      const dsum = sumDigits(dateStr);
      const tsum = sumDigits(timeStr);
      const csum = sumDigits(cityStr);
      const seed = dsum + tsum + csum;

      let autonomy = (seed % 10) + 5;
      let rage = ((seed * 3) % 10) + 3;
      let clarity = ((seed * 5) % 10) + 4;
      let armor = ((seed * 7) % 10) + 4;

      if(mode === "strict"){ clarity += 2; }
      if(mode === "myth"){ armor += 1; autonomy += 1; }
      if(mode === "hard"){ rage += 2; autonomy += 1; }

      autonomy = clamp(autonomy, 1, 15);
      rage = clamp(rage, 1, 15);
      clarity = clamp(clarity, 1, 15);
      armor = clamp(armor, 1, 15);

      const archetypes = [
        { name:"ADM: OFF-SCRIPT ARCHITECT", line:"ты переписываешь карту. не ждёшь сигналов — создаёшь правила." },
        { name:"ADM: BERSERK SHIELD", line:"давление → броня. контроль со стороны → твоя сила включается." },
        { name:"ADM: COLD OPERATOR", line:"ты выигрываешь тишиной. видишь механику, а не драму." },
        { name:"ADM: WRAITH ADMIN", line:"ты исчезаешь из сценариев и входишь только там, где у тебя контроль." },
      ];
      const arch = archetypes[seed % archetypes.length];

      const quests = [
        "выйти из чужого скрипта и собрать свой протокол автономности.",
        "конвертировать давление в топливо: без роли «удобной» версии.",
        "закрыть доступ системе к твоему времени и голосу.",
        "собрать броню свободы: границы, правила, дисциплина без бытовухи.",
      ];
      const mq = quests[(seed + 1) % quests.length];

      const route = [
        { k:"DAY 1", v:"SCAN: damage log → 3 скрипта, которые тебя выключают." },
        { k:"DAY 2", v:"PURGE: 1 триггер → удалить контакт/привычку/шум." },
        { k:"DAY 3", v:"ARMOR: 1 граница → держать 24h без отката." },
        { k:"DAY 4", v:"OFF SCRIPT: 1 действие → поступок вне старой роли." },
        { k:"DAY 5", v:"PROBABILITY FIELD: выбор → один риск ради результата." },
        { k:"DAY 6", v:"PATCH NOTES: фиксация → что стало сильнее/чище." },
        { k:"DAY 7", v:"BOSS CHECK: тест → там, где раньше сдавал(а) позиции." },
      ];

      const clearance =
        (autonomy + armor >= rage + clarity) ? "CLEARANCE: ARMOR/AUTONOMY" : "CLEARANCE: RAGE/CLARITY";

      const id = `ID: ADM-${String(seed).padStart(4,'0')}`;

      return {
        seed,
        id,
        clearance,
        stats: { autonomy, rage, clarity, armor },
        arch,
        mq,
        route
      };
    }

    function renderMultipass(mp){
      // unlock
      multipass.classList.remove('locked');
      multipass.classList.add('unlock');

      multipassStatus.textContent = "status: generated";
      mpId.textContent = mp.id;
      mpTag.textContent = mp.clearance;

      statRows.innerHTML = [
        {k:"autonomy", v: mp.stats.autonomy},
        {k:"rage", v: mp.stats.rage},
        {k:"clarity", v: mp.stats.clarity},
        {k:"armor", v: mp.stats.armor},
      ].map(s => `<div class="mRow"><span>${s.k}</span><i>${s.v}/15</i></div>`).join("");

      archetypeText.textContent = `${mp.arch.name}: ${mp.arch.line}`;
      mainQuestText.textContent = mp.mq;

      routeRows.innerHTML = mp.route.map(r =>
        `<div class="mRow"><span>${r.k}</span><i>${r.v}</i></div>`
      ).join("");

      // build meter
      const pct = computeBuildMeter(mp.stats);
      buildFill.style.width = `${pct}%`;
      buildPct.textContent = `${pct}%`;
    }

    genBtn?.addEventListener('click', ()=>{
      const ds = birthDate?.value || "";
      const ts = birthTime?.value || "";
      const cs = birthCity?.value || "";
      const mode = engineMode?.value || "strict";

      if(!ds || !ts || !cs){
        showLog("ERROR: date + time + city required.");
        genBtn.animate([{transform:'translateX(0)'},{transform:'translateX(-3px)'},{transform:'translateX(3px)'},{transform:'translateX(0)'}],{duration:240});
        return;
      }

      const mp = generateMultipass({dateStr: ds, timeStr: ts, cityStr: cs, mode});
      showLog(`SYSTEM: MULTIPASS generated. seed=${mp.seed}.`);
      renderMultipass(mp);

      // jump to multipass output
      setTimeout(()=> multipass.scrollIntoView({behavior:'smooth', block:'start'}), 180);
    });

    // ---------- QUEST ENGINE ----------
    const qTitle = document.getElementById('qTitle');
    const qStep  = document.getElementById('qStep');
    const qText  = document.getElementById('qText');
    const choicesEl = document.getElementById('choices');
    const resultEl = document.getElementById('result');
    const nextBtn = document.getElementById('nextBtn');
    const backBtn = document.getElementById('backBtn');
    const hint = document.getElementById('hint');
    const progressFill = document.getElementById('progressFill');
    const questPct = document.getElementById('questPct');
    const buildNameEl = document.getElementById('buildName');

    const stats = { autonomy: 0, rage: 0, clarity: 0, armor: 0 };

    const QUEST = [
      {
        code: "scan: origin",
        title: "deep scan: точка сбоя",
        text: "какой момент стал твоей точкой «я больше не играю по их правилам»?",
        options: [
          { label:"меня ограничили / упаковали", sub:"рамки включили злость. ты выбрал(а) свободу.", add:{autonomy:2, armor:1} },
          { label:"меня унизили / обесценили", sub:"ты перестал(а) просить. ты начал(а) действовать.", add:{rage:2, armor:1} },
          { label:"я устал(а) от чужого сценария", sub:"тишина. ясность. решение.", add:{clarity:2, autonomy:1} },
        ]
      },
      {
        code: "scan: borders",
        title: "deep scan: что забирают",
        text: "что система чаще всего пытается у тебя забрать прямо сейчас?",
        options: [
          { label:"время", sub:"тебя держат в шуме задач и чужих ожиданий.", add:{clarity:1, autonomy:2} },
          { label:"голос", sub:"ты сдерживаешься, чтобы «не спровоцировать».", add:{rage:1, autonomy:2, armor:1} },
          { label:"свободу действий", sub:"контроль через правила/страх/вину.", add:{armor:2, autonomy:1} },
        ]
      },
      {
        code: "scan: mask",
        title: "deep scan: маска",
        text: "какую роль ты носишь, чтобы тебя «принимали»?",
        options: [
          { label:"удобный(ая)", sub:"ты режешь себя, чтобы влезть.", add:{autonomy:2, armor:1} },
          { label:"сильный(ая) всегда", sub:"фасад держит. внутри перегрев.", add:{armor:2, clarity:1} },
          { label:"хороший(ая)", sub:"мораль как броня безопасности.", add:{clarity:2, autonomy:1} },
        ]
      },
      {
        code: "scan: boss",
        title: "deep scan: босс",
        text: "какой «босс» держит твою силу выключенной?",
        options: [
          { label:"страх осуждения", sub:"тебя держит толпа, не враг.", add:{autonomy:2, clarity:1} },
          { label:"страх потери", sub:"зависимость от того, что дают.", add:{armor:2, autonomy:1} },
          { label:"страх ошибки", sub:"перфекционизм как клетка.", add:{clarity:2, armor:1} },
        ]
      },
      {
        code: "scan: fuel",
        title: "deep scan: топливо",
        text: "что реально заряжает тебя до состояния «могу всё»?",
        options: [
          { label:"риск", sub:"нужна высота напряжения, чтобы включиться.", add:{rage:2, armor:1} },
          { label:"тишина", sub:"когда шум выключен — ты становишься точным.", add:{clarity:2, autonomy:1} },
          { label:"результат", sub:"тебя заводит факт: «я сделал(а)».", add:{autonomy:2, clarity:1} },
        ]
      }
    ];

    let step = 0;
    let selected = Array(QUEST.length).fill(null);

    function calcBuildName(){
      const entries = [
        ["ADM: OFF-SCRIPT ARCHITECT", stats.autonomy],
        ["ADM: RAGE ENGINE", stats.rage],
        ["ADM: COLD OPERATOR", stats.clarity],
        ["ADM: ARMOR BUILDER", stats.armor],
      ].sort((a,b)=>b[1]-a[1]);
      const top = entries[0][0];
      const score = entries[0][1];
      let name = top;
      if(score <= 2) name = "UNLOCKING...";
      if(top === "ADM: OFF-SCRIPT ARCHITECT" && stats.clarity >= 3) name = "ADM: STRATEGIST";
      if(top === "ADM: RAGE ENGINE" && stats.armor >= 3) name = "ADM: BERSERK SHIELD";
      if(top === "ADM: COLD OPERATOR" && stats.autonomy >= 3) name = "ADM: ARCHITECT";
      if(top === "ADM: ARMOR BUILDER" && stats.clarity >= 3) name = "ADM: FORTRESS MIND";
      buildNameEl.textContent = name;
    }

    function renderQuest(){
      const q = QUEST[step];
      qTitle.textContent = q.title;
      qStep.textContent = `step ${step+1}/${QUEST.length}`;
      qText.textContent = q.text;

      const answered = selected.filter(x => x !== null).length;
      const pct = Math.round((answered / QUEST.length) * 100);
      progressFill.style.width = `${pct}%`;
      questPct.textContent = `${pct}%`;

      backBtn.style.display = step === 0 ? "none" : "inline-flex";
      nextBtn.querySelector('span').textContent = (step === QUEST.length - 1) ? "finish" : "next";
      nextBtn.disabled = (selected[step] === null);
      hint.textContent = selected[step] === null ? "choose to unlock next" : "confirmed. move.";

      choicesEl.innerHTML = "";
      resultEl.classList.remove("on");
      resultEl.textContent = "";

      q.options.forEach((opt, idx) => {
        const btn = document.createElement("button");
        btn.className = "choice";
        btn.type = "button";
        btn.innerHTML = `${opt.label}<small>${opt.sub}</small>`;

        if(selected[step] === idx){
          btn.style.borderColor = "rgba(11,12,20,.35)";
          btn.style.opacity = "1";
        }else{
          btn.style.opacity = "0.95";
        }

        btn.addEventListener("click", () => {
          if(selected[step] === idx) return;

          const prevIdx = selected[step];
          if(prevIdx !== null){
            const prevAdd = q.options[prevIdx].add;
            Object.keys(prevAdd).forEach(k => stats[k] -= prevAdd[k]);
          }

          selected[step] = idx;
          const add = opt.add;
          Object.keys(add).forEach(k => stats[k] += add[k]);

          calcBuildName();

          resultEl.textContent =
            `SYSTEM LOG: [${q.code}] accepted → ` +
            Object.entries(add).map(([k,v]) => `+${k}:${v}`).join(" ") +
            ` | build updated.`;
          resultEl.classList.add("on");

          renderQuest();
        });

        choicesEl.appendChild(btn);
      });

      calcBuildName();
    }

    backBtn.addEventListener("click", ()=>{
      if(step === 0) return;
      step -= 1;
      renderQuest();
    });

    nextBtn.addEventListener("click", ()=>{
      if(selected[step] === null) return;

      if(step === QUEST.length - 1){
        resultEl.textContent = `QUEST COMPLETE: build locked → ${buildNameEl.textContent}.`;
        resultEl.classList.add("on");
        nextBtn.animate([{ transform:'translateY(0)' },{ transform:'translateY(-2px)' },{ transform:'translateY(0)' }], { duration: 260 });
        return;
      }

      step += 1;
      renderQuest();
    });

    renderQuest();
  </script>
</body>
</html>
