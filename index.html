<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>PRTCL 108 — ADM MODE</title>
  <meta name="description" content="PRTCL 108 — терминал скана персонажа и вход в ADM MODE."/>
  <style>
    :root{
      --bg0:#04070b;
      --bg1:#071019;
      --glass: rgba(240,245,255,.08);
      --glass2: rgba(240,245,255,.12);
      --edge: rgba(205,235,255,.28);
      --edge2: rgba(205,235,255,.16);
      --text:#eaf5ff;
      --muted: rgba(234,245,255,.72);
      --dim: rgba(234,245,255,.52);
      --accent:#d8c7ff;       /* перламутр-лиловый */
      --accent2:#bff3ff;      /* лёд */
      --danger:#ff4d6d;
      --ok:#66ffcc;
      --warn:#ffd166;
      --shadow: 0 18px 60px rgba(0,0,0,.55);
      --radius: 22px;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --sans: ui-sans-serif, -apple-system, system-ui, Segoe UI, Roboto, Inter, Arial, "Noto Sans", "Helvetica Neue", sans-serif;
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      color:var(--text);
      font-family:var(--sans);
      background:
        radial-gradient(1200px 900px at 20% 10%, rgba(216,199,255,.18), transparent 60%),
        radial-gradient(900px 700px at 80% 20%, rgba(191,243,255,.14), transparent 55%),
        radial-gradient(900px 900px at 50% 80%, rgba(255,255,255,.06), transparent 60%),
        linear-gradient(180deg, var(--bg0), var(--bg1));
      overflow-x:hidden;
    }

    /* мягкий "космический туман" */
    .fog{
      position:fixed; inset:-20%;
      background:
        radial-gradient(closest-side at 20% 40%, rgba(191,243,255,.08), transparent 65%),
        radial-gradient(closest-side at 70% 30%, rgba(216,199,255,.07), transparent 60%),
        radial-gradient(closest-side at 60% 80%, rgba(255,255,255,.05), transparent 60%);
      filter: blur(30px);
      opacity:.9;
      pointer-events:none;
      animation: drift 14s ease-in-out infinite alternate;
      z-index:0;
    }
    @keyframes drift{
      from{ transform: translate3d(-2%, -1%, 0) scale(1.02); }
      to{ transform: translate3d(2%, 1%, 0) scale(1.04); }
    }

    .wrap{
      position:relative;
      z-index:1;
      max-width:1200px;
      margin:0 auto;
      padding:28px 16px 40px;
    }

    /* верх */
    header{
      display:flex;
      align-items:flex-end;
      justify-content:space-between;
      gap:14px;
      margin-bottom:16px;
    }
    .brand{
      display:flex; flex-direction:column; gap:8px;
    }
    .title{
      font-weight:900;
      letter-spacing:.08em;
      text-transform:uppercase;
      font-size: clamp(28px, 4.4vw, 56px);
      line-height:1;
      background: linear-gradient(90deg, rgba(234,245,255,.92), rgba(216,199,255,.92), rgba(191,243,255,.92), rgba(234,245,255,.92));
      background-size: 240% 100%;
      -webkit-background-clip:text;
      background-clip:text;
      color:transparent;
      animation: shimmer 4.8s linear infinite;
      text-shadow: 0 0 22px rgba(216,199,255,.18);
    }
    @keyframes shimmer{
      from{background-position:0% 50%}
      to{background-position:240% 50%}
    }
    .subtitle{
      font-family:var(--mono);
      color:var(--muted);
      font-size:12px;
      letter-spacing:.12em;
      text-transform:uppercase;
    }

    .badge{
      display:flex;
      flex-direction:column;
      align-items:flex-end;
      gap:8px;
      min-width: 220px;
    }
    .adm{
      font-family:var(--mono);
      letter-spacing:.22em;
      text-transform:uppercase;
      padding:10px 14px;
      border-radius:999px;
      background: linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.04));
      border:1px solid var(--edge2);
      box-shadow: var(--shadow);
      position:relative;
      overflow:hidden;
    }
    .adm::before{
      content:"";
      position:absolute; inset:-2px;
      background: linear-gradient(90deg, transparent, rgba(216,199,255,.18), rgba(191,243,255,.18), transparent);
      transform: translateX(-60%);
      animation: scan 2.8s ease-in-out infinite;
      opacity:.8;
    }
    @keyframes scan{
      0%{transform:translateX(-60%)}
      55%{transform:translateX(60%)}
      100%{transform:translateX(60%)}
    }
    .adm span{position:relative}

    .manifest{
      max-width:520px;
      font-size:14px;
      color:var(--muted);
      text-align:right;
      line-height:1.35;
    }

    /* сетка */
    .grid{
      display:grid;
      grid-template-columns: 1.05fr .95fr;
      gap:16px;
      align-items:start;
      margin-top:14px;
    }
    @media (max-width: 980px){
      .grid{grid-template-columns:1fr}
      .badge{align-items:flex-start}
      .manifest{text-align:left}
    }

    .panel{
      background: linear-gradient(180deg, rgba(255,255,255,.07), rgba(255,255,255,.03));
      border: 1px solid var(--edge2);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
      position:relative;
    }
    .panel::after{
      content:"";
      position:absolute;
      inset:0;
      background:
        linear-gradient(90deg, rgba(255,255,255,.03), transparent 22%, transparent 78%, rgba(255,255,255,.03)),
        repeating-linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.04) 1px, transparent 1px, transparent 6px);
      opacity:.18;
      pointer-events:none;
      mix-blend-mode: screen;
    }
    .panelHead{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      padding:14px 16px;
      border-bottom:1px solid var(--edge2);
      position:relative;
      z-index:1;
    }
    .panelHead h2{
      margin:0;
      font-size:13px;
      letter-spacing:.16em;
      font-family:var(--mono);
      text-transform:uppercase;
      color:rgba(234,245,255,.88);
    }
    .panelBody{ padding:16px; position:relative; z-index:1; }

    /* терминал ввода */
    .form{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:12px;
    }
    @media (max-width:560px){ .form{grid-template-columns:1fr} }

    label{display:flex; flex-direction:column; gap:6px; font-size:12px; color:var(--dim); letter-spacing:.06em;}
    input, select{
      width:100%;
      padding:12px 12px;
      border-radius:14px;
      border:1px solid rgba(205,235,255,.22);
      background: rgba(0,0,0,.22);
      color:var(--text);
      outline:none;
      font-family:var(--mono);
      font-size:13px;
    }
    input:focus, select:focus{border-color: rgba(216,199,255,.55); box-shadow: 0 0 0 3px rgba(216,199,255,.12);}

    .row{
      display:flex; gap:10px; flex-wrap:wrap; align-items:center;
      margin-top:12px;
    }
    .btn{
      border:none;
      cursor:pointer;
      padding:12px 14px;
      border-radius:14px;
      font-family:var(--mono);
      letter-spacing:.12em;
      text-transform:uppercase;
      font-size:12px;
      color:rgba(234,245,255,.92);
      background: linear-gradient(180deg, rgba(216,199,255,.22), rgba(191,243,255,.14));
      border:1px solid rgba(216,199,255,.38);
      box-shadow: 0 12px 28px rgba(0,0,0,.35);
      position:relative;
      overflow:hidden;
      transition: transform .12s ease, filter .12s ease;
    }
    .btn:hover{ transform: translateY(-1px); filter:brightness(1.05); }
    .btn:active{ transform: translateY(0px) scale(.99); }

    .btnGhost{
      background: rgba(0,0,0,.18);
      border:1px solid rgba(205,235,255,.22);
      color:rgba(234,245,255,.86);
    }

    .hint{
      margin:10px 0 0;
      color:var(--dim);
      font-size:12px;
      line-height:1.35;
    }

    /* MULTIPASS */
    .passShell{
      display:grid;
      grid-template-columns: 260px 1fr;
      gap:14px;
      align-items:stretch;
    }
    @media (max-width: 760px){ .passShell{grid-template-columns:1fr} }

    .card{
      border-radius:18px;
      border:1px solid rgba(205,235,255,.22);
      background: rgba(0,0,0,.22);
      padding:14px;
      position:relative;
      overflow:hidden;
      min-height: 180px;
    }
    .card::before{
      content:"";
      position:absolute; inset:-2px;
      background:
        radial-gradient(120px 120px at 22% 15%, rgba(216,199,255,.22), transparent 60%),
        radial-gradient(120px 120px at 80% 70%, rgba(191,243,255,.18), transparent 65%),
        linear-gradient(90deg, rgba(255,255,255,.05), transparent 26%, transparent 74%, rgba(255,255,255,.05));
      opacity:.85;
      pointer-events:none;
      mix-blend-mode: screen;
    }
    .passSmall{
      height: 310px;
      display:flex;
      flex-direction:column;
      justify-content:space-between;
    }
    .passTop{
      display:flex; align-items:flex-start; justify-content:space-between; gap:10px;
      position:relative; z-index:1;
    }
    .tag{
      font-family:var(--mono);
      font-size:10px;
      letter-spacing:.18em;
      text-transform:uppercase;
      color:rgba(234,245,255,.78);
    }
    .seal{
      width:72px; height:72px;
      border-radius:999px;
      border:1px solid rgba(216,199,255,.55);
      background: radial-gradient(circle at 30% 30%, rgba(216,199,255,.24), rgba(0,0,0,.18));
      position:relative;
      display:grid; place-items:center;
      transform: rotate(-8deg);
      opacity:.0;
      filter: drop-shadow(0 10px 18px rgba(0,0,0,.35));
    }
    .seal.show{ animation: sealPop .6s ease forwards; }
    @keyframes sealPop{
      0%{opacity:0; transform: scale(.6) rotate(-18deg);}
      65%{opacity:1; transform: scale(1.06) rotate(-8deg);}
      100%{opacity:1; transform: scale(1) rotate(-8deg);}
    }
    .seal svg{opacity:.9}
    .sealText{
      position:absolute;
      inset:8px;
      border-radius:999px;
      border:1px dashed rgba(191,243,255,.38);
      animation: spin 10s linear infinite;
      opacity:.65;
    }
    @keyframes spin{ to{ transform: rotate(360deg);} }

    .passMid{
      position:relative; z-index:1;
      display:grid;
      grid-template-columns: 1fr;
      gap:10px;
      margin-top:10px;
    }
    .kv{
      display:flex; justify-content:space-between; gap:10px;
      font-family:var(--mono);
      font-size:12px;
      letter-spacing:.06em;
      padding:8px 10px;
      border-radius:12px;
      background: rgba(255,255,255,.05);
      border:1px solid rgba(205,235,255,.14);
    }
    .kv b{font-weight:700; color:rgba(234,245,255,.86)}
    .kv span{color:rgba(234,245,255,.76)}

    .passFull{
      min-height: 310px;
      display:flex;
      flex-direction:column;
      gap:12px;
    }

    .heroLine{
      display:flex; align-items:center; justify-content:space-between;
      gap:10px;
      position:relative; z-index:1;
    }
    .role{
      font-size:16px;
      font-weight:800;
      letter-spacing:.06em;
    }
    .clear{
      font-family:var(--mono);
      font-size:11px;
      letter-spacing:.18em;
      text-transform:uppercase;
      color:rgba(234,245,255,.78);
      padding:8px 10px;
      border-radius:999px;
      border:1px solid rgba(205,235,255,.18);
      background: rgba(0,0,0,.18);
      white-space:nowrap;
    }

    .stats{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:10px;
      position:relative; z-index:1;
    }
    @media (max-width:560px){ .stats{grid-template-columns:1fr} }

    .stat{
      padding:10px 10px;
      border-radius:14px;
      border:1px solid rgba(205,235,255,.14);
      background: rgba(255,255,255,.04);
    }
    .statTop{
      display:flex; justify-content:space-between; align-items:center;
      font-family:var(--mono);
      font-size:11px;
      letter-spacing:.12em;
      text-transform:uppercase;
      color:rgba(234,245,255,.78);
      margin-bottom:8px;
    }
    .bar{
      height:10px;
      border-radius:999px;
      background: rgba(0,0,0,.25);
      border:1px solid rgba(205,235,255,.14);
      overflow:hidden;
    }
    .fill{
      height:100%;
      width:50%;
      background: linear-gradient(90deg, rgba(216,199,255,.55), rgba(191,243,255,.48));
      box-shadow: 0 0 18px rgba(216,199,255,.18);
    }

    .locked{
      margin-top:6px;
      padding:12px;
      border-radius:16px;
      border:1px dashed rgba(205,235,255,.22);
      color:rgba(234,245,255,.78);
      background: rgba(0,0,0,.14);
      font-size:13px;
      line-height:1.35;
      position:relative;
      z-index:1;
    }
    .locked small{display:block; margin-top:6px; color:rgba(234,245,255,.58); font-family:var(--mono); letter-spacing:.1em;}

    /* скан-луч */
    .scanBeam{
      position:absolute;
      left:-20%;
      top:0;
      width:140%;
      height:32%;
      background: linear-gradient(90deg, transparent, rgba(191,243,255,.22), rgba(216,199,255,.18), transparent);
      transform: translateY(-120%);
      filter: blur(2px);
      opacity:0;
      pointer-events:none;
      z-index:2;
    }
    .scanBeam.run{
      opacity:1;
      animation: beam 1.1s ease-in-out forwards;
    }
    @keyframes beam{
      0%{transform: translateY(-120%); opacity:0}
      20%{opacity:1}
      100%{transform: translateY(320%); opacity:0}
    }

    /* сюжет */
    .story{
      font-family:var(--mono);
      font-size:13px;
      line-height:1.55;
      color:rgba(234,245,255,.84);
      white-space:pre-line;
      padding:12px 12px;
      border-radius:16px;
      border:1px solid rgba(205,235,255,.16);
      background: rgba(0,0,0,.18);
      position:relative;
      overflow:hidden;
    }
    .story::before{
      content:"";
      position:absolute; inset:0;
      background: radial-gradient(220px 140px at 10% 30%, rgba(216,199,255,.10), transparent 70%);
      opacity:.9;
      pointer-events:none;
    }
    .choices{
      display:grid;
      grid-template-columns: 1fr;
      gap:10px;
      margin-top:12px;
    }
    .choice{
      text-align:left;
      width:100%;
      padding:12px 12px;
      border-radius:16px;
      border:1px solid rgba(205,235,255,.18);
      background: rgba(255,255,255,.04);
      color:rgba(234,245,255,.88);
      cursor:pointer;
      transition: transform .12s ease, border-color .12s ease, background .12s ease;
      position:relative;
      overflow:hidden;
    }
    .choice:hover{ transform: translateY(-1px); border-color: rgba(216,199,255,.42); background: rgba(216,199,255,.06); }
    .choice .t{
      font-family:var(--mono);
      letter-spacing:.10em;
      text-transform:uppercase;
      font-size:12px;
      margin-bottom:6px;
      color:rgba(234,245,255,.86);
    }
    .choice .d{ font-size:13px; color:rgba(234,245,255,.72); line-height:1.35; }

    /* мини-график волны */
    .waveBox{
      margin-top:12px;
      padding:12px;
      border-radius:16px;
      border:1px solid rgba(205,235,255,.16);
      background: rgba(0,0,0,.16);
    }
    .waveTop{
      display:flex; align-items:center; justify-content:space-between; gap:10px;
      font-family:var(--mono);
      font-size:11px;
      letter-spacing:.14em;
      text-transform:uppercase;
      color:rgba(234,245,255,.76);
      margin-bottom:10px;
    }
    .pill{
      padding:7px 10px;
      border-radius:999px;
      border:1px solid rgba(205,235,255,.18);
      background: rgba(255,255,255,.03);
      color:rgba(234,245,255,.78);
      font-family:var(--mono);
      font-size:10px;
      letter-spacing:.14em;
      text-transform:uppercase;
      white-space:nowrap;
    }
    .footerNote{
      margin-top:14px;
      color:rgba(234,245,255,.55);
      font-size:12px;
      line-height:1.35;
    }
  </style>
</head>
<body>
  <div class="fog"></div>

  <div class="wrap">
    <header>
      <div class="brand">
        <div class="title">PRTCL 108</div>
        <div class="subtitle">ТЕРМИНАЛ СКАНА ПЕРСОНАЖА · ВХОД В ADM MODE</div>
      </div>
      <div class="badge">
        <div class="adm"><span>ADM MODE</span></div>
        <div class="manifest" id="manifest"></div>
      </div>
    </header>

    <div class="grid">
      <!-- ЛЕВО: Терминал -->
      <section class="panel">
        <div class="panelHead">
          <h2>TERMINAL</h2>
          <button class="btn btnGhost" id="btnNewManifest" type="button">сменить манифест</button>
        </div>
        <div class="panelBody">
          <div class="form">
            <label>
              Дата рождения
              <input id="dob" type="date" value="1996-08-01"/>
            </label>
            <label>
              Место рождения (город)
              <input id="pob" type="text" value="Нальчик"/>
            </label>
            <label>
              Код происхождения (ORIGIN)
              <input id="origin" type="text" value="RU-NAL"/>
            </label>
            <label>
              Корпус
              <select id="body">
                <option value="F" selected>Женский</option>
                <option value="M">Мужской</option>
                <option value="X">Нейтральный</option>
              </select>
            </label>
          </div>

          <div class="row">
            <button class="btn" id="btnScan" type="button">запустить скан-луч</button>
            <button class="btn btnGhost" id="btnReset" type="button">сброс</button>
          </div>

          <p class="hint">
            Скан не “оценивает” тебя. Он фиксирует конфигурацию: <b>параметры</b>, <b>таланты</b>, <b>системные петли</b> и <b>траекторию допуска</b>.
            Дальше ты выбираешь протокол — и мир отвечает.
          </p>

          <div class="waveBox">
            <div class="waveTop">
              <span>ТРЕК ДОПУСКА</span>
              <span class="pill" id="seedPill">SEED: —</span>
            </div>
            <svg id="wave" width="100%" height="120" viewBox="0 0 680 120" preserveAspectRatio="none" aria-label="Волнообразный график">
              <defs>
                <linearGradient id="g1" x1="0" y1="0" x2="1" y2="0">
                  <stop offset="0" stop-color="rgba(216,199,255,.75)"/>
                  <stop offset=".55" stop-color="rgba(191,243,255,.70)"/>
                  <stop offset="1" stop-color="rgba(234,245,255,.60)"/>
                </linearGradient>
                <filter id="glow">
                  <feGaussianBlur stdDeviation="2.8" result="b"/>
                  <feMerge>
                    <feMergeNode in="b"/>
                    <feMergeNode in="SourceGraphic"/>
                  </feMerge>
                </filter>
              </defs>

              <!-- сетка -->
              <g opacity=".18">
                <path d="M0 20 H680 M0 60 H680 M0 100 H680" stroke="rgba(205,235,255,.35)" stroke-width="1"/>
                <path d="M85 0 V120 M170 0 V120 M255 0 V120 M340 0 V120 M425 0 V120 M510 0 V120 M595 0 V120"
                      stroke="rgba(205,235,255,.20)" stroke-width="1"/>
              </g>

              <!-- волна -->
              <path id="wavePath" d="M0 60 C 85 20, 170 100, 255 60 S 425 20, 510 60 S 595 100, 680 60"
                    fill="none" stroke="url(#g1)" stroke-width="3.2" filter="url(#glow)" />

              <!-- кристалл / шестиугольник -->
              <g id="sigil" transform="translate(560 18)" opacity=".9">
                <polygon points="60,10 92,28 92,64 60,82 28,64 28,28"
                         fill="rgba(0,0,0,.10)" stroke="rgba(216,199,255,.55)" stroke-width="1.2"/>
                <polygon points="60,18 83,31 83,61 60,74 37,61 37,31"
                         fill="rgba(191,243,255,.08)" stroke="rgba(191,243,255,.45)" stroke-width="1"/>
                <path d="M60 18 L60 74 M37 31 L83 61 M83 31 L37 61"
                      stroke="rgba(234,245,255,.22)" stroke-width="1"/>
                <polygon points="60,26 74,40 60,70 46,40"
                         fill="rgba(216,199,255,.12)" stroke="rgba(234,245,255,.28)" stroke-width="1"/>
              </g>
            </svg>

            <div class="footerNote">
              Волна меняется от твоего SEED. Это “пульс допуска”: как мир пропускает тебя сквозь слои.
            </div>
          </div>
        </div>
      </section>

      <!-- ПРАВО: MULTIPASS + сюжет -->
      <section class="panel" id="rightPanel">
        <div class="scanBeam" id="beam"></div>

        <div class="panelHead">
          <h2>MULTIPASS</h2>
          <div class="tag" id="statusTag">СТАТУС: ОЖИДАНИЕ</div>
        </div>

        <div class="panelBody">
          <div class="passShell">
            <!-- маленький -->
            <div class="card passSmall" id="passSmall">
              <div class="passTop">
                <div>
                  <div class="tag">PRTCL 108</div>
                  <div class="tag" style="opacity:.7;margin-top:6px;">ID / CLEARANCE / ORIGIN / SEED</div>
                </div>

                <div class="seal" id="seal">
                  <div class="sealText"></div>
                  <svg width="34" height="34" viewBox="0 0 64 64" aria-hidden="true">
                    <path d="M32 6l10 16 18 4-12 14 2 18-18-7-18 7 2-18L4 26l18-4z"
                          fill="rgba(216,199,255,.20)" stroke="rgba(191,243,255,.55)" stroke-width="2"/>
                  </svg>
                </div>
              </div>

              <div class="passMid">
                <div class="kv"><b>ID</b><span id="outId">—</span></div>
                <div class="kv"><b>CLEARANCE</b><span id="outClear">—</span></div>
                <div class="kv"><b>ORIGIN</b><span id="outOrigin">—</span></div>
                <div class="kv"><b>SEED</b><span id="outSeed">—</span></div>
              </div>

              <div class="tag" style="position:relative;z-index:1;opacity:.72">
                ПЕЧАТЬ ПРОТОКОЛА АКТИВИРУЕТСЯ ПОСЛЕ СКАНА
              </div>
            </div>

            <!-- полный -->
            <div class="card passFull" id="passFull">
              <div class="heroLine">
                <div class="role" id="outRole">Роль: —</div>
                <div class="clear" id="outMode">режим: —</div>
              </div>

              <div class="stats" id="stats"></div>

              <div class="locked" id="locked">
                ДОСТУП К СКРЫТЫМ СЛОЯМ ЗАПЕЧАТАН.
                <small>Подпиши протокол: выбери один из трёх сценариев ниже.</small>
              </div>
            </div>
          </div>

          <div style="height:12px"></div>

          <div class="story" id="story">
            [TERMINAL] Подай данные. Запусти скан-луч.
            Мир не даст “ответов”. Он выдаст тебе интерфейс.
          </div>

          <div class="choices" id="choices"></div>
        </div>
      </section>
    </div>
  </div>

  <script>
    // =========================
    // Манифест (меняется каждый раз)
    // =========================
    const MANIFESTS = [
      "Если система закрывает двери — я становлюсь дверью.\nЕсли система ставит границы — я становлюсь линией разрыва.\nЯ не прошу разрешения.\nЯ создаю протокол.",
      "Там, где другим выдают правила — мне выдают допуск.\nЯ не спорю с системой.\nЯ переписываю её интерфейс.",
      "Система любит удобных.\nНо я — ошибка, которую нельзя исправить.\nПоэтому меня приходится пропускать.",
      "Я не “ищу себя”.\nЯ проектирую себя.\nТам, где страшно — там мой вход.",
      "Я не верю в случайности.\nЯ верю в сигналы.\nИ сегодня сигнал — это ты."
    ];

    function setManifest(){
      const m = MANIFESTS[Math.floor(Math.random()*MANIFESTS.length)];
      document.getElementById('manifest').textContent = m;
    }

    // =========================
    // Утилиты
    // =========================
    function pad(n){ return String(n).padStart(2,'0'); }

    // простая детерминированная "хеш-строка" (seed) из ввода
    function makeSeed(dob, pob, origin, body){
      const s = `${dob}|${pob}|${origin}|${body}`.toUpperCase();
      let h1 = 2166136261; // FNV-1a
      for(let i=0;i<s.length;i++){
        h1 ^= s.charCodeAt(i);
        h1 = Math.imul(h1, 16777619);
      }
      // в "читабельный" seed
      const a = (h1 >>> 0).toString(16).toUpperCase().padStart(8,'0');
      const b = ((h1*2654435761) >>> 0).toString(16).toUpperCase().padStart(8,'0');
      return `${a.slice(0,4)}-${a.slice(4)}-${b.slice(0,4)}`;
    }

    function seededRand(seedStr){
      // xorshift32 на основе seedStr
      let x = 0;
      for (let i=0;i<seedStr.length;i++){
        x = (x + seedStr.charCodeAt(i) * 2654435761) >>> 0;
        x ^= x << 13; x >>>= 0;
        x ^= x >>> 17; x >>>= 0;
        x ^= x << 5; x >>>= 0;
      }
      return function(){
        x ^= x << 13; x >>>= 0;
        x ^= x >>> 17; x >>>= 0;
        x ^= x << 5; x >>>= 0;
        return (x >>> 0) / 4294967296;
      }
    }

    function clamp(v,min,max){ return Math.max(min, Math.min(max, v)); }

    // =========================
    // Лор/система параметров (игровые термины, русские)
    // =========================
    const STAT_DEFS = [
      {key:"воля",   label:"Воля"},
      {key:"холод",  label:"Холод"},
      {key:"риск",   label:"Риск"},
      {key:"интуиция", label:"Интуиция"},
      {key:"контроль", label:"Контроль"},
      {key:"энергия", label:"Энергия"},
    ];

    const ROLES = [
      {name:"Линия разрыва", mode:"ADM / breach"},
      {name:"Носитель протокола", mode:"ADM / carrier"},
      {name:"Слом системы", mode:"ADM / anomaly"},
      {name:"Оператор допуска", mode:"ADM / clearance"},
      {name:"Тихий взлом", mode:"ADM / silent"},
      {name:"Холодный архитектор", mode:"ADM / architect"},
    ];

    const CLEARANCE = [
      "C0 — Наблюдатель",
      "C1 — Гость порога",
      "C2 — Допуск базовый",
      "C3 — Допуск расширенный",
      "C4 — Проводник слоя",
      "C5 — Администратор поля"
    ];

    // 33 карточки (библиотека-скелет; позже наполним деталями)
    // сейчас используем часть как "модули таланта"
    const MODULES = [
      "Скан-луч", "Теневая дисциплина", "Режим холодной ясности", "Молчание как оружие", "Резкая граница",
      "Память тела", "Пульс риска", "Сдвиг траектории", "Инстинкт двери", "Броня свободы",
      "Взлом привычки", "Слепая зона системы", "Фильтр шума", "Сборка силы", "Запрет на оправдания",
      "Нулевая зависимость", "Чистый импульс", "Механика выбора", "Доверие к себе", "Контроль без жестокости",
      "Лезвие правды", "Сбор данных", "Точка выхода", "Своя карта", "Тихая власть",
      "Снятие иллюзий", "Холодный фокус", "Воля без истерики", "Проверка реальности", "Новый протокол",
      "Код допуска", "Перезапуск", "Печать"
    ];

    // =========================
    // Сюжет: вертикальный срез "Вход в ADM MODE"
    // =========================
    function buildIntroStory(profile){
      return [
        `[TERMINAL] Скан завершён.\n`,
        `Система не говорит “кто ты”. Она выдаёт конфигурацию.\n`,
        `Твои данные превращены в допуск, а допуск — в маршрут.\n`,
        `Дальше важен не ответ. Важен выбор.\n\n`,
        `Перед тобой три протокола. Каждый открывает слой — и оставляет след.`
      ].join("");
    }

    const CHOICES = [
      {
        code:"PRTCL-Δ (Разрыв)",
        title:"Подписать протокол «РАЗРЫВ»",
        desc:"Ты не обходишь ограничения. Ты разрываешь линию и проходишь напрямую.",
        effect:(p)=>({ воля:+12, риск:+10, контроль:-6, холод:+6 }),
        unlock:"Слой 1: Порог → «Коридор разлома». Ты получаешь доступ к дверям, которых “нет”."
      },
      {
        code:"PRTCL-Σ (Сборка)",
        title:"Подписать протокол «СБОРКА»",
        desc:"Ты собираешь себя как систему: тихо, точно, без лишних движений.",
        effect:(p)=>({ контроль:+12, холод:+8, риск:-6, энергия:+6 }),
        unlock:"Слой 1: Порог → «Палуба сборки». Тебя пропускают потому, что ты стабильна."
      },
      {
        code:"PRTCL-Ω (Аномалия)",
        title:"Подписать протокол «АНОМАЛИЯ»",
        desc:"Ты входишь как ошибка. Система не может классифицировать тебя — и сдаётся.",
        effect:(p)=>({ интуиция:+12, риск:+6, холод:-4, энергия:+8 }),
        unlock:"Слой 1: Порог → «Зона тишины». События перестраиваются вокруг тебя."
      }
    ];

    // =========================
    // Рендер
    // =========================
    const els = {
      dob: document.getElementById('dob'),
      pob: document.getElementById('pob'),
      origin: document.getElementById('origin'),
      body: document.getElementById('body'),
      btnScan: document.getElementById('btnScan'),
      btnReset: document.getElementById('btnReset'),
      btnNewManifest: document.getElementById('btnNewManifest'),
      statusTag: document.getElementById('statusTag'),
      seal: document.getElementById('seal'),
      outId: document.getElementById('outId'),
      outClear: document.getElementById('outClear'),
      outOrigin: document.getElementById('outOrigin'),
      outSeed: document.getElementById('outSeed'),
      outRole: document.getElementById('outRole'),
      outMode: document.getElementById('outMode'),
      stats: document.getElementById('stats'),
      locked: document.getElementById('locked'),
      story: document.getElementById('story'),
      choices: document.getElementById('choices'),
      beam: document.getElementById('beam'),
      seedPill: document.getElementById('seedPill'),
      wavePath: document.getElementById('wavePath'),
    };

    let STATE = {
      scanned: false,
      profile: null,
      baseStats: null,
      finalStats: null,
      chosen: null
    };

    function makeProfile(){
      const dob = els.dob.value || "1996-08-01";
      const pob = (els.pob.value || "—").trim();
      const origin = (els.origin.value || "—").trim();
      const body = els.body.value;

      const seed = makeSeed(dob, pob, origin, body);
      const rnd = seededRand(seed);

      const role = ROLES[Math.floor(rnd()*ROLES.length)];
      const clearance = CLEARANCE[Math.floor(rnd()*CLEARANCE.length)];

      // ID (формат: 108-YYMMDD-XXXX)
      const d = new Date(dob);
      const yy = String(d.getFullYear()).slice(-2);
      const mm = pad(d.getMonth()+1);
      const dd = pad(d.getDate());
      const suffix = Math.floor(rnd()*9999).toString().padStart(4,'0');
      const id = `108-${yy}${mm}${dd}-${suffix}`;

      // базовые статы 30..80
      const base = {};
      STAT_DEFS.forEach(s=>{
        base[s.key] = Math.round(30 + rnd()*50);
      });

      // таланты (3 модуля из 33)
      const mods = [];
      const pool = [...MODULES];
      for(let i=0;i<3;i++){
        const idx = Math.floor(rnd()*pool.length);
        mods.push(pool.splice(idx,1)[0]);
      }

      return {
        dob, pob, origin, body,
        seed, id,
        role, clearance,
        baseStats: base,
        modules: mods,
      };
    }

    function renderStats(statsObj){
      els.stats.innerHTML = "";
      for(const def of STAT_DEFS){
        const v = clamp(statsObj[def.key] ?? 0, 0, 100);
        const el = document.createElement('div');
        el.className = 'stat';
        el.innerHTML = `
          <div class="statTop">
            <span>${def.label}</span>
            <span>${v}</span>
          </div>
          <div class="bar"><div class="fill" style="width:${v}%"></div></div>
        `;
        els.stats.appendChild(el);
      }
    }

    function updateWave(seed){
      // меняем волнообразный путь по seed
      const rnd = seededRand(seed);
      const y0 = 55 + Math.round((rnd()*14)-7);
      const y1 = 18 + Math.round(rnd()*18);
      const y2 = 100 - Math.round(rnd()*18);
      const y3 = 55 + Math.round((rnd()*14)-7);
      const y4 = 18 + Math.round(rnd()*18);
      const y5 = 100 - Math.round(rnd()*18);
      const y6 = 55 + Math.round((rnd()*14)-7);

      const d = `M0 ${y0} C 85 ${y1}, 170 ${y2}, 255 ${y3} S 425 ${y4}, 510 ${y3} S 595 ${y5}, 680 ${y6}`;
      els.wavePath.setAttribute('d', d);
    }

    function renderPass(profile){
      els.outId.textContent = profile.id;
      els.outClear.textContent = profile.clearance;
      els.outOrigin.textContent = profile.origin || "—";
      els.outSeed.textContent = profile.seed;

      els.outRole.textContent = `Роль: ${profile.role.name}`;
      els.outMode.textContent = profile.role.mode;

      els.seedPill.textContent = `SEED: ${profile.seed}`;
      updateWave(profile.seed);

      renderStats(profile.baseStats);

      // "скрытый слой" — таланты
      els.locked.innerHTML = `
        <b>СКРЫТЫЕ СЛОИ ЗАПЕЧАТАНЫ.</b><br/>
        Таланты обнаружены, но скрыты печатью протокола.
        <small>МОДУЛИ (запечатано): ${profile.modules.join(" · ")}</small>
      `;
    }

    function renderChoices(){
      els.choices.innerHTML = "";
      CHOICES.forEach((c, idx)=>{
        const b = document.createElement('button');
        b.className = 'choice';
        b.type = 'button';
        b.innerHTML = `
          <div class="t">${c.code}</div>
          <div class="d"><b>${c.title}</b><br/>${c.desc}</div>
        `;
        b.addEventListener('click', ()=>applyChoice(idx));
        els.choices.appendChild(b);
      });
    }

    function applyChoice(i){
      if(!STATE.scanned || !STATE.profile) return;

      const choice = CHOICES[i];
      const base = {...STATE.profile.baseStats};
      const delta = choice.effect(STATE.profile);

      // применяем эффекты
      const finalStats = {...base};
      for(const k in delta){
        finalStats[k] = clamp((finalStats[k] || 0) + delta[k], 0, 100);
      }

      STATE.chosen = choice;
      STATE.finalStats = finalStats;

      els.statusTag.textContent = "СТАТУС: ПРОТОКОЛ ПОДПИСАН";
      renderStats(finalStats);

      // печать
      els.seal.classList.add('show');

      // раскрытие скрытого слоя
      els.locked.innerHTML = `
        <b>ПЕЧАТЬ АКТИВНА.</b><br/>
        Протокол принят. Система открывает слой и фиксирует след.
        <small>РАСКРЫТЫЕ МОДУЛИ: ${STATE.profile.modules.join(" · ")}</small>
      `;

      // сюжетный вывод
      const lines = [];
      lines.push(`[PROTOCOL] ${choice.code} — подтверждён.`);
      lines.push(`${choice.unlock}`);
      lines.push(``);
      lines.push(`Система записала изменения:`);
      lines.push(`• Воля ${fmtDelta(delta.воля)}  • Холод ${fmtDelta(delta.холод)}  • Риск ${fmtDelta(delta.риск)}`);
      lines.push(`• Интуиция ${fmtDelta(delta.интуиция)}  • Контроль ${fmtDelta(delta.контроль)}  • Энергия ${fmtDelta(delta.энергия)}`);
      lines.push(``);
      lines.push(`Следующий шаг: открыть «Слой 2» (мы добавим его следующей сценой).`);

      els.story.textContent = lines.join("\n");

      // выборы превращаем в "следующая сцена / перезапуск"
      els.choices.innerHTML = "";
      const next = document.createElement('button');
      next.className = 'btn';
      next.type = 'button';
      next.textContent = 'перейти к слою 2 (заглушка)';
      next.addEventListener('click', ()=>{
        els.story.textContent = `[LAYER 2] Заглушка.\nДальше мы добавим новую сцену с развилками, событиями и системой наград.\n\nСкажи: хочешь слой 2 как «миссию» или как «диалог/встречу»?`;
      });

      const restart = document.createElement('button');
      restart.className = 'btn btnGhost';
      restart.type = 'button';
      restart.textContent = 'пересобрать персонажа';
      restart.addEventListener('click', resetAll);

      const row = document.createElement('div');
      row.className = 'row';
      row.appendChild(next);
      row.appendChild(restart);
      els.choices.appendChild(row);
    }

    function fmtDelta(v){
      if(v === undefined || v === null) return "+0";
      if(v > 0) return `+${v}`;
      if(v < 0) return `${v}`;
      return "+0";
    }

    function runScan(){
      // создаем профиль
      const profile = makeProfile();
      STATE.profile = profile;

      // UI
      els.statusTag.textContent = "СТАТУС: СКАНИРОВАНИЕ";
      els.seal.classList.remove('show');

      // анимация луча
      els.beam.classList.remove('run');
      void els.beam.offsetWidth;
      els.beam.classList.add('run');

      // имитация "процесса"
      const steps = [
        "[SCAN] Инициализация терминала…",
        "[SCAN] Снятие сигнатуры…",
        "[SCAN] Калибровка допуска…",
        "[SCAN] Генерация MULTIPASS…",
        "[SCAN] Запечатывание протокола…"
      ];

      els.story.textContent = steps.join("\n");

      setTimeout(()=>{
        STATE.scanned = true;
        els.statusTag.textContent = "СТАТУС: СКАН ЗАВЕРШЁН";
        renderPass(profile);
        els.story.textContent = buildIntroStory(profile);
        renderChoices();
      }, 950);
    }

    function resetAll(){
      STATE = { scanned:false, profile:null, baseStats:null, finalStats:null, chosen:null };
      els.statusTag.textContent = "СТАТУС: ОЖИДАНИЕ";
      els.seal.classList.remove('show');
      els.outId.textContent = "—";
      els.outClear.textContent = "—";
      els.outOrigin.textContent = "—";
      els.outSeed.textContent = "—";
      els.outRole.textContent = "Роль: —";
      els.outMode.textContent = "режим: —";
      els.seedPill.textContent = "SEED: —";
      updateWave("0000-0000-0000"); // нейтрально
      renderStats({воля:50, холод:50, риск:50, интуиция:50, контроль:50, энергия:50});
      els.locked.innerHTML = `ДОСТУП К СКРЫТЫМ СЛОЯМ ЗАПЕЧАТАН.<small>Подпиши протокол: выбери один из трёх сценариев ниже.</small>`;
      els.story.textContent = "[TERMINAL] Подай данные. Запусти скан-луч.\nМир не даст “ответов”. Он выдаст тебе интерфейс.";
      els.choices.innerHTML = "";
    }

    // =========================
    // События
    // =========================
    els.btnScan.addEventListener('click', runScan);
    els.btnReset.addEventListener('click', resetAll);
    els.btnNewManifest.addEventListener('click', setManifest);

    // init
    setManifest();
    resetAll();
  </script>
</body>
</html>