<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>PRTCL 108</title>
  <meta name="description" content="PRTCL 108 ‚Äî —Å–∫—Ä—ã—Ç—ã–π —Ä–µ–∂–∏–º –∏–≥—Ä—ã. –°–∫–∞–Ω–∏—Ä—É–π —Å–≤–æ–π MULTIPASS –∏ –ø–æ–ª—É—á–∏ –±–∞–∑–æ–≤—ã–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏. –ü–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø ‚Äî –ø–æ unlock." />

  <!-- Export libs (PNG/PDF) -->
  <script defer src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>

  <style>
    :root{
      /* Pearl / Apple-ish (dark) */
      --bg0:#0B0B12;
      --bg1:#0E0C18;
      --bg2:#120E22;

      --ink:#F8FBFF;
      --muted: rgba(248,251,255,.70);

      --glass: rgba(255,255,255,.08);
      --glass2: rgba(255,255,255,.05);
      --stroke: rgba(255,255,255,.18);
      --stroke2: rgba(255,255,255,.10);

      --p1:#FFFFFF;
      --p2:#F4EFFF;
      --p3:#E7D8FF;
      --p4:#D7F2FF;
      --p5:#E9E3FF;

      --shadow: 0 24px 90px rgba(0,0,0,.55);
      --shadow2: 0 10px 40px rgba(0,0,0,.45);

      --r:24px;
      --r2:18px;

      --shineSpeed: 2.9s;
      --scanSpeed: 2.3s;

      --brandA: rgba(231,216,255,.85);
      --brandB: rgba(215,242,255,.85);
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
      color:var(--ink);
      background:
        radial-gradient(1100px 700px at 18% 12%, rgba(231,216,255,.18), transparent 60%),
        radial-gradient(900px 520px at 82% 18%, rgba(215,242,255,.14), transparent 62%),
        radial-gradient(900px 700px at 55% 86%, rgba(244,239,255,.12), transparent 62%),
        linear-gradient(180deg, var(--bg0) 0%, var(--bg1) 45%, var(--bg2) 100%);
      overflow-x:hidden;
    }

    /* ===== FX Layers ===== */
    .fx{position:fixed; inset:0; pointer-events:none; z-index:0;}
    .fx.vignette{
      background: radial-gradient(80% 70% at 50% 40%, transparent 55%, rgba(0,0,0,.62) 100%);
      opacity:.65;
    }
    .fx.scanlines{
      opacity:.10;
      background: repeating-linear-gradient(
        to bottom,
        rgba(255,255,255,.06) 0px,
        rgba(255,255,255,.06) 1px,
        transparent 2px,
        transparent 7px
      );
      mix-blend-mode: overlay;
    }
    .fx.noise{
      opacity:.10;
      background-image:
        url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='160' height='160'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.9' numOctaves='2' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='160' height='160' filter='url(%23n)' opacity='.35'/%3E%3C/svg%3E");
      mix-blend-mode: overlay;
    }
    .fx.glow{
      opacity:.65;
      background:
        radial-gradient(900px 650px at 20% 10%, rgba(231,216,255,.20), transparent 60%),
        radial-gradient(800px 550px at 80% 20%, rgba(215,242,255,.18), transparent 62%),
        radial-gradient(900px 650px at 55% 88%, rgba(244,239,255,.14), transparent 64%);
      filter: blur(2px);
      mix-blend-mode: screen;
      animation: breathe 6.2s ease-in-out infinite;
    }
    @keyframes breathe{
      0%,100%{transform:scale(1); opacity:.55}
      50%{transform:scale(1.02); opacity:.78}
    }

    canvas#particles{
      position:fixed; inset:0;
      z-index:1;
      pointer-events:none;
      opacity:.55;
      mix-blend-mode: screen;
    }

    /* ===== Layout ===== */
    .wrap{
      position:relative;
      z-index:2;
      max-width:1160px;
      margin:0 auto;
      padding:28px 18px 84px;
    }

    .topbar{
      display:flex; align-items:center; justify-content:space-between;
      gap:12px; flex-wrap:wrap;
      margin-bottom:16px;
    }

    .brand{display:flex; align-items:center; gap:12px; user-select:none;}
    .sig{
      width:40px; height:40px; border-radius:14px;
      border:1px solid rgba(255,255,255,.20);
      background:
        radial-gradient(24px 18px at 30% 30%, rgba(255,255,255,.22), transparent 62%),
        radial-gradient(24px 18px at 70% 70%, rgba(231,216,255,.22), transparent 62%),
        rgba(255,255,255,.05);
      box-shadow: 0 0 26px rgba(231,216,255,.18);
      position:relative; overflow:hidden;
    }
    .sig:after{
      content:"";
      position:absolute; inset:-35%;
      background: conic-gradient(from 180deg, transparent, rgba(255,255,255,.20), rgba(231,216,255,.16), transparent);
      animation: spin 7s linear infinite;
      opacity:.8;
    }
    @keyframes spin{to{transform:rotate(360deg)}}

    .chips{display:flex; gap:10px; flex-wrap:wrap; justify-content:flex-end}
    .chip{
      font-size:12px;
      color:rgba(248,251,255,.76);
      border:1px solid rgba(255,255,255,.16);
      border-radius:999px;
      padding:7px 10px;
      background: rgba(255,255,255,.05);
      white-space:nowrap;
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
    }

    /* ===== Hero ===== */
    .hero{
      border:1px solid rgba(255,255,255,.16);
      border-radius: var(--r);
      background: linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.05));
      box-shadow: var(--shadow);
      position:relative;
      overflow:hidden;
      isolation:isolate;
    }

    .heroGrid{
      position:absolute; inset:0;
      pointer-events:none;
      opacity:.22;
      background:
        linear-gradient(to right, rgba(255,255,255,.10) 1px, transparent 1px),
        linear-gradient(to bottom, rgba(255,255,255,.08) 1px, transparent 1px);
      background-size: 72px 72px;
      mix-blend-mode: overlay;
      mask: radial-gradient(70% 70% at 50% 35%, #000 60%, transparent 100%);
      z-index:0;
    }

    /* Scan beam */
    .scanBeam{
      position:absolute; inset:-10%;
      pointer-events:none;
      opacity:.0;
      z-index:1;
      background:
        linear-gradient(to bottom,
          transparent 0%,
          rgba(255,255,255,.00) 35%,
          rgba(231,216,255,.08) 46%,
          rgba(255,255,255,.35) 50%,
          rgba(215,242,255,.12) 53%,
          transparent 62%,
          transparent 100%
        );
      mix-blend-mode: screen;
      filter: blur(.4px);
      transform: translateY(-45%);
    }
    .hero.scanning .scanBeam{
      opacity:1;
      animation: scanPass var(--scanSpeed) linear infinite;
    }
    @keyframes scanPass{
      0%{transform: translateY(-55%)}
      100%{transform: translateY(55%)}
    }

    .heroInner{
      position:relative;
      z-index:2;
      display:grid;
      grid-template-columns: 1.15fr .85fr;
      gap:16px;
      padding: 22px;
    }
    @media (max-width: 920px){ .heroInner{grid-template-columns:1fr;} }

    .pane{
      border:1px solid rgba(255,255,255,.14);
      border-radius: var(--r2);
      background: rgba(255,255,255,.05);
      padding: 18px;
      position:relative;
      overflow:hidden;
      backdrop-filter: blur(14px);
      -webkit-backdrop-filter: blur(14px);
      box-shadow: var(--shadow2);
    }

    .title{
      margin:0;
      font-weight: 1000;
      font-size: 54px;
      letter-spacing: .06em;
      text-transform: uppercase;
      line-height: 1.02;

      background: linear-gradient(110deg,
        var(--p1) 0%,
        var(--p2) 18%,
        var(--p3) 38%,
        var(--p4) 58%,
        var(--p5) 78%,
        var(--p1) 100%
      );
      background-size: 240% 100%;
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      filter: drop-shadow(0 0 18px rgba(231,216,255,.18));
      position:relative;
    }
    @media (max-width: 560px){ .title{font-size:42px} }

    .title:after{
      content:"";
      position:absolute; inset:-20% -40%;
      background: linear-gradient(120deg,
        transparent 35%,
        rgba(255,255,255,.22) 45%,
        rgba(231,216,255,.18) 50%,
        rgba(215,242,255,.20) 55%,
        transparent 65%
      );
      transform: translateX(-40%);
      animation: shine var(--shineSpeed) ease-in-out infinite;
      mix-blend-mode: screen;
      pointer-events:none;
      opacity:.9;
      filter: blur(.2px);
      mask: linear-gradient(#000, #000);
    }
    @keyframes shine{
      0%{transform: translateX(-45%)}
      60%{transform: translateX(45%)}
      100%{transform: translateX(45%)}
    }

    .subline{
      margin-top:10px;
      display:flex; align-items:center; gap:10px; flex-wrap:wrap;
      color: rgba(248,251,255,.72);
      font-size:12px;
      letter-spacing:.10em;
      text-transform:uppercase;
    }
    .dot2{
      width:9px; height:9px; border-radius:50%;
      background: rgba(255,255,255,.88);
      box-shadow: 0 0 16px rgba(231,216,255,.26);
    }

    .lead{
      margin: 16px 0 0;
      font-size: 15.5px;
      line-height: 1.65;
      color: rgba(248,251,255,.90);
      max-width: 78ch;
    }
    .lead b{color: var(--ink)}
    .mini{
      margin: 12px 0 0;
      font-size: 13.7px;
      line-height: 1.65;
      color: var(--muted);
    }

    .proofRow{
      display:grid;
      grid-template-columns: repeat(3, 1fr);
      gap:12px;
      margin-top:16px;
    }
    @media (max-width: 920px){ .proofRow{grid-template-columns:1fr;} }

    .proof{
      border:1px solid rgba(255,255,255,.12);
      border-radius: 16px;
      background: rgba(255,255,255,.04);
      padding: 12px;
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      position:relative;
      overflow:hidden;
      transition: transform .18s ease, filter .18s ease, border-color .18s ease;
    }
    .proof:hover{
      transform: translateY(-2px);
      border-color: rgba(231,216,255,.24);
      filter: brightness(1.06);
    }
    .proof .k{
      font-size:12px;
      letter-spacing:.12em;
      text-transform:uppercase;
      color: rgba(248,251,255,.72);
      display:flex; align-items:center; gap:8px;
      margin-bottom:8px;
    }
    .proof .k .p{
      width:7px; height:7px; border-radius:50%;
      background: rgba(215,242,255,.72);
      box-shadow: 0 0 14px rgba(215,242,255,.22);
    }
    .proof .v{
      font-size:13.5px;
      line-height:1.55;
      color: rgba(248,251,255,.86);
    }

    /* Form */
    .formTitle{
      display:flex; align-items:center; justify-content:space-between; gap:12px;
      margin:0 0 12px;
      letter-spacing:.12em;
      text-transform:uppercase;
      font-weight:900;
      font-size:13px;
      color: rgba(248,251,255,.86);
    }
    .statusPill{
      font-size:11px;
      border:1px solid rgba(255,255,255,.14);
      border-radius:999px;
      padding:7px 10px;
      background: rgba(255,255,255,.04);
      color: rgba(248,251,255,.70);
      letter-spacing:.10em;
      text-transform:uppercase;
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
    }

    label{
      display:block;
      font-size:12px;
      color: rgba(248,251,255,.72);
      margin: 10px 0 7px;
      letter-spacing:.04em;
    }
    .row{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:10px;
    }
    @media (max-width: 520px){ .row{grid-template-columns:1fr;} }

    input, select{
      width:100%;
      padding: 12px 12px;
      border-radius: 14px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.04);
      color: var(--ink);
      outline:none;
      font-size:14px;
      box-shadow: inset 0 0 0 1px rgba(255,255,255,.03);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
    }
    input:focus, select:focus{
      border-color: rgba(231,216,255,.32);
      box-shadow: 0 0 0 4px rgba(231,216,255,.10);
    }
    input[type="date"]::-webkit-calendar-picker-indicator,
    input[type="time"]::-webkit-calendar-picker-indicator{
      filter: invert(1);
      opacity:.85;
    }

    .cta{
      width:100%;
      margin-top: 14px;
      padding: 13px 14px;
      border-radius: 14px;
      border:1px solid rgba(255,255,255,.18);
      background:
        linear-gradient(90deg,
          rgba(255,255,255,.14),
          rgba(231,216,255,.14),
          rgba(215,242,255,.12),
          rgba(255,255,255,.12)
        );
      color: var(--ink);
      font-weight: 950;
      letter-spacing:.14em;
      text-transform:uppercase;
      cursor:pointer;
      user-select:none;
      box-shadow: 0 0 35px rgba(231,216,255,.12);
      transition: transform .12s ease, filter .12s ease;
      position:relative;
      overflow:hidden;
    }
    .cta:hover{filter:brightness(1.07)}
    .cta:active{transform: translateY(1px)}
    .cta:before{
      content:"";
      position:absolute; inset:-60% -40%;
      background: linear-gradient(120deg,
        transparent 35%,
        rgba(255,255,255,.16) 45%,
        rgba(231,216,255,.14) 52%,
        transparent 65%
      );
      transform: translateX(-35%);
      animation: shineBtn 3.2s ease-in-out infinite;
      opacity:.9;
      pointer-events:none;
      filter: blur(.2px);
    }
    @keyframes shineBtn{
      0%{transform: translateX(-45%)}
      55%{transform: translateX(45%)}
      100%{transform: translateX(45%)}
    }

    /* Sections */
    .section{
      margin-top: 14px;
      border:1px solid rgba(255,255,255,.12);
      border-radius: var(--r);
      background: rgba(255,255,255,.04);
      box-shadow: var(--shadow2);
      padding: 16px;
      backdrop-filter: blur(14px);
      -webkit-backdrop-filter: blur(14px);
      position:relative;
      overflow:hidden;
    }
    .section h2{
      margin:0 0 10px;
      letter-spacing:.12em;
      text-transform:uppercase;
      font-size:13px;
      color: rgba(248,251,255,.86);
    }
    .section .grid{
      display:grid;
      grid-template-columns: repeat(12, 1fr);
      gap:12px;
    }
    .card{
      grid-column: span 6;
      border:1px solid rgba(255,255,255,.10);
      border-radius: 18px;
      background: rgba(255,255,255,.03);
      padding: 14px;
      position:relative;
      overflow:hidden;
      transition: transform .18s ease, border-color .18s ease, filter .18s ease;
    }
    .card:hover{
      transform: translateY(-2px);
      border-color: rgba(231,216,255,.22);
      filter: brightness(1.06);
    }
    .card.wide{grid-column: span 12;}
    @media (max-width: 920px){ .card{grid-column: span 12;} }

    .tag{
      display:inline-flex; align-items:center; gap:8px;
      padding:7px 10px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.03);
      color: rgba(248,251,255,.72);
      font-size:12px;
      letter-spacing:.08em;
      text-transform:uppercase;
      margin-bottom:10px;
    }
    .tag .tDot{
      width:8px; height:8px; border-radius:50%;
      background: rgba(231,216,255,.80);
      box-shadow: 0 0 14px rgba(231,216,255,.24);
    }

    .text{
      color: rgba(248,251,255,.86);
      line-height: 1.62;
      font-size: 13.9px;
    }
    .list{
      margin:10px 0 0;
      padding-left:18px;
      color: rgba(248,251,255,.78);
      line-height:1.62;
      font-size: 13.4px;
    }
    .list li{margin:7px 0}

    /* Scroll reveal */
    .reveal{opacity:0; transform: translateY(14px); filter: blur(3px);}
    .reveal.show{opacity:1; transform: translateY(0); filter: blur(0); transition: all .7s ease;}

    /* Tiny micro-glitch */
    .microglitch{position:relative;}
    .microglitch:after{
      content: attr(data-g);
      position:absolute; inset:0;
      opacity:0;
      color: rgba(231,216,255,.65);
      transform: translateX(-1px);
      clip-path: inset(0 0 50% 0);
      animation: micro 6.8s infinite;
      pointer-events:none;
    }
    @keyframes micro{
      0%, 93%, 100%{opacity:0}
      94%{opacity:.55}
      95%{opacity:0}
    }

    .footer{
      margin-top: 16px;
      color: rgba(248,251,255,.58);
      font-size: 12px;
      line-height: 1.55;
      text-align:center;
      padding: 14px 0 0;
    }

    /* ===== MULTIPASS MODAL (new) ===== */
    .modalBack{
      position:fixed; inset:0;
      background: rgba(0,0,0,.55);
      display:none;
      align-items:center;
      justify-content:center;
      padding: 16px;
      z-index: 30;
      backdrop-filter: blur(14px);
      -webkit-backdrop-filter: blur(14px);
    }
    .modalBack.show{display:flex}

    .modal{
      width:min(1180px, 100%);
      border:1px solid rgba(255,255,255,.16);
      border-radius: 26px;
      background: linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.04));
      box-shadow: 0 40px 160px rgba(0,0,0,.65);
      overflow:hidden;
      transform: translateY(10px);
      opacity:0;
      animation: modalIn .35s ease forwards;
    }
    @keyframes modalIn{to{transform:translateY(0);opacity:1}}
    .modalHead{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      padding: 14px 16px;
      border-bottom:1px solid rgba(255,255,255,.12);
    }
    .modalTitle{
      display:flex; align-items:center; gap:10px;
      letter-spacing:.12em;
      text-transform:uppercase;
      font-weight:900;
      font-size:12px;
      color: rgba(248,251,255,.82);
    }
    .close{
      border:1px solid rgba(255,255,255,.16);
      background: rgba(255,255,255,.06);
      color: rgba(248,251,255,.88);
      border-radius: 999px;
      padding: 8px 10px;
      cursor:pointer;
      letter-spacing:.08em;
      text-transform:uppercase;
      font-size:11px;
    }
    .modalBody{
      padding: 16px;
      display:grid;
      grid-template-columns: .95fr 1.05fr;
      gap:14px;
    }
    @media (max-width: 980px){ .modalBody{grid-template-columns:1fr;} }

    .stack{display:grid; gap:12px;}

    .pass{
      border:1px solid rgba(255,255,255,.14);
      border-radius: 22px;
      background: rgba(255,255,255,.05);
      backdrop-filter: blur(14px);
      -webkit-backdrop-filter: blur(14px);
      box-shadow: var(--shadow2);
      overflow:hidden;
      position:relative;
    }

    .seal{
      width:76px; height:76px; border-radius:999px;
      border:1px solid rgba(255,255,255,.16);
      background:
        radial-gradient(26px 18px at 30% 30%, rgba(255,255,255,.22), transparent 62%),
        radial-gradient(26px 18px at 70% 70%, rgba(215,242,255,.16), transparent 62%),
        rgba(255,255,255,.05);
      box-shadow: 0 0 28px rgba(231,216,255,.18);
      position:relative;
      overflow:hidden;
      flex: 0 0 auto;
    }
    .seal:after{
      content:"STAMP";
      position:absolute; inset:0;
      display:grid; place-items:center;
      font-size:11px;
      letter-spacing:.20em;
      font-weight:900;
      color: rgba(248,251,255,.80);
      text-transform:uppercase;
      transform: rotate(-12deg);
      text-shadow: 0 1px 0 rgba(0,0,0,.25);
    }

    /* badges */
    .badgeRow{display:flex; gap:10px; flex-wrap:wrap; align-items:center}
    .rarityBadge{
      display:inline-flex; align-items:center; gap:8px;
      padding:7px 10px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.04);
      font-size:12px;
      letter-spacing:.10em;
      text-transform:uppercase;
      color: rgba(248,251,255,.82);
      user-select:none;
    }
    .rarityDot{
      width:9px; height:9px; border-radius:999px;
      background: rgba(255,255,255,.75);
      box-shadow: 0 0 16px rgba(231,216,255,.18);
    }
    .rarityCommon .rarityDot{ opacity:.7 }
    .rarityRare .rarityDot{ background: var(--brandB); box-shadow: 0 0 18px rgba(215,242,255,.20);}
    .rarityEpic .rarityDot{ background: var(--brandA); box-shadow: 0 0 18px rgba(231,216,255,.22);}
    .rarityMythic .rarityDot{ background: rgba(255,230,160,.90); box-shadow: 0 0 18px rgba(255,230,160,.20);}

    /* mini card */
    .miniPass{
      padding: 14px;
      display:grid;
      grid-template-columns: 92px 1fr;
      gap: 12px;
      align-items:stretch;
    }
    .miniHead{
      grid-column:1/-1;
      display:flex; align-items:flex-start; justify-content:space-between; gap:12px;
      margin-bottom: 2px;
    }
    .miniHead .t1{
      font-weight: 950;
      letter-spacing:.16em;
      text-transform:uppercase;
      font-size:12px;
      color: rgba(248,251,255,.88);
    }
    .miniHead .t2{
      margin-top:6px;
      font-size:12px;
      color: rgba(248,251,255,.66);
      letter-spacing:.10em;
      text-transform:uppercase;
      display:flex;
      flex-direction:column;
      gap:8px;
    }

    .avatarFace{
      width:92px; height:110px;
      border-radius: 18px;
      overflow:hidden;
      border:1px solid rgba(255,255,255,.16);
      background: rgba(255,255,255,.04);
      position:relative;
    }
    .avatarFace img{
      width:100%; height:100%;
      object-fit:cover;
      object-position: 50% 25%;
      transform: scale(1.07);
      display:block;
      filter: contrast(1.02) saturate(1.05);
    }

    .miniInfo{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:10px;
      align-content:start;
    }
    .kv{
      padding:10px;
      border-radius: 16px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.03);
      position:relative;
    }
    .kv .k{
      font-size:10px;
      letter-spacing:.18em;
      text-transform:uppercase;
      color: rgba(248,251,255,.58);
      margin-bottom:6px;
    }
    .kv .v{
      font-size:14px;
      font-weight: 900;
      color: rgba(248,251,255,.92);
      word-break:break-word;
    }

    .miniFoot{
      grid-column:1/-1;
      display:flex; justify-content:space-between; gap:10px; align-items:center;
      border-top: 1px solid rgba(255,255,255,.10);
      padding-top: 10px;
      margin-top: 2px;
      color: rgba(248,251,255,.62);
      font-size: 12px;
    }
    .protoSig{
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Courier New", monospace;
      letter-spacing:.06em;
      white-space:nowrap;
    }

    /* full card */
    .fullPass{ padding: 14px; display:grid; gap:12px; }
    .fullHead{
      display:flex; justify-content:space-between; gap:12px; align-items:flex-start;
    }
    .fullHead .t1{
      font-weight: 950;
      letter-spacing:.16em;
      text-transform:uppercase;
      font-size:12px;
      color: rgba(248,251,255,.86);
      display:flex;
      flex-wrap:wrap;
      gap:10px;
      align-items:center;
    }
    .fullHead .t2{
      margin-top:6px;
      font-size:20px;
      font-weight: 950;
      letter-spacing:.02em;
      text-transform:uppercase;
      color: rgba(248,251,255,.92);
    }

    .fullBody{
      display:grid;
      grid-template-columns: 1fr 1.2fr;
      gap:12px;
      align-items:stretch;
    }
    @media (max-width: 560px){ .fullBody{grid-template-columns:1fr;} }

    .avatarFull{
      border-radius: 20px;
      overflow:hidden;
      border:1px solid rgba(255,255,255,.16);
      background: rgba(255,255,255,.04);
      min-height: 320px;
    }
    .avatarFull img{
      width:100%; height:100%;
      object-fit:cover;
      object-position: 50% 50%;
      display:block;
      filter: contrast(1.02) saturate(1.05);
      transform: scale(1.02);
    }

    .stats{display:grid; gap:10px; align-content:start;}
    .line{
      padding:12px;
      border-radius: 18px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.03);
      color: rgba(248,251,255,.86);
      font-size:14px;
      line-height:1.45;
      position:relative;
      overflow:hidden;
      opacity:1;
      transform: translateY(0);
      transition: opacity .35s ease, transform .35s ease;
    }
    .line b{color: rgba(248,251,255,.92);}
    .line.reveal{animation: revealUp .45s ease both;}
    @keyframes revealUp{from{opacity:0; transform: translateY(8px)} to{opacity:1; transform: translateY(0)}}

    .locked::after{
      content:"üîí locked";
      position:absolute;
      inset:0;
      display:flex; align-items:center; justify-content:center;
      font-weight: 950;
      letter-spacing:.14em;
      text-transform:uppercase;
      font-size:12px;
      color: rgba(248,251,255,.68);
      background:
        radial-gradient(300px 160px at 30% 25%, rgba(231,216,255,.10), transparent 60%),
        radial-gradient(280px 150px at 80% 25%, rgba(215,242,255,.08), transparent 60%),
        rgba(0,0,0,.28);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      opacity:1;
      transition: opacity .35s ease, transform .35s ease;
      border-radius: 18px;
    }
    .unlocked.locked::after{opacity:0; transform:scale(1.02); pointer-events:none;}

    /* right terminal */
    .panel{
      border:1px solid rgba(255,255,255,.12);
      border-radius: 22px;
      background: rgba(255,255,255,.04);
      box-shadow: var(--shadow2);
      overflow:hidden;
    }
    .panelHead{
      padding: 14px;
      border-bottom:1px solid rgba(255,255,255,.10);
      display:flex; justify-content:space-between; align-items:center; gap:10px;
    }
    .panelTitle{
      font-size:12px;
      letter-spacing:.12em;
      text-transform:uppercase;
      font-weight: 950;
      color: rgba(248,251,255,.82);
      display:flex; align-items:center; gap:10px;
    }
    .lights{display:flex; gap:8px}
    .lights span{width:10px; height:10px; border-radius:999px; background: rgba(255,255,255,.14);}
    .lights span:nth-child(1){ background: rgba(215,242,255,.24); }
    .lights span:nth-child(2){ background: rgba(231,216,255,.20); }
    .lights span:nth-child(3){ background: rgba(255,255,255,.12); }

    .panelBody{padding: 14px;}
    .log{
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Courier New", monospace;
      font-size:12px;
      line-height:1.6;
      color: rgba(248,251,255,.78);
      margin:0;
      white-space:pre-wrap;
    }
    .log .muted{ color: rgba(248,251,255,.55); }
    .log .ok{ color: rgba(180,255,240,.85); }
    .log .warn{ color: rgba(231,216,255,.85); }

    .btnRow{display:flex; gap:10px; flex-wrap:wrap; margin-top:12px}
    .btn2{
      border:1px solid rgba(255,255,255,.16);
      background: rgba(255,255,255,.06);
      color: rgba(248,251,255,.90);
      padding: 10px 12px;
      border-radius: 14px;
      letter-spacing:.12em;
      text-transform:uppercase;
      font-weight: 950;
      font-size:11px;
      cursor:pointer;
      transition: filter .12s ease, transform .12s ease;
    }
    .btn2:hover{filter:brightness(1.08)}
    .btn2:active{transform: translateY(1px)}
    .btn2.primary{
      background:
        linear-gradient(90deg,
          rgba(255,255,255,.12),
          rgba(231,216,255,.12),
          rgba(215,242,255,.10),
          rgba(255,255,255,.10)
        );
      border-color: rgba(255,255,255,.20);
    }
  </style>
</head>

<body>
  <div class="fx glow"></div>
  <div class="fx scanlines"></div>
  <div class="fx noise"></div>
  <div class="fx vignette"></div>
  <canvas id="particles"></canvas>

  <div class="wrap">
    <div class="topbar">
      <div class="brand">
        <div class="sig"></div>
        <div>
          <div style="display:flex; gap:10px; align-items:center; flex-wrap:wrap;">
            <div style="font-weight:950; letter-spacing:.14em;">PRTCL 108</div>
            <div class="chip microglitch" data-g="HUD">HUD</div>
            <div class="chip microglitch" data-g="SCAN">SCAN</div>
          </div>
          <div style="font-size:12px; color:rgba(248,251,255,.62); letter-spacing:.08em; margin-top:4px;">
            —Å–∫—Ä—ã—Ç—ã–π —Ä–µ–∂–∏–º –∏–≥—Ä—ã: –∫–∞—Ä—Ç–∞ –∏–≥—Ä–æ–∫–∞ + —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏
          </div>
        </div>
      </div>

      <div class="chips">
        <div class="chip">–ø—Ä–æ—Å—Ç—ã–µ —Ç–µ—Ä–º–∏–Ω—ã</div>
        <div class="chip">–±–µ–∑ –æ–±–µ—â–∞–Ω–∏–π</div>
        <div class="chip">—Å–Ω–∞—á–∞–ª–∞ –±–∞–∑–æ–≤—ã–π —Å–∫–∞–Ω</div>
      </div>
    </div>

    <section class="hero" id="hero">
      <div class="heroGrid"></div>
      <div class="scanBeam"></div>

      <div class="heroInner">
        <!-- Left -->
        <div class="pane reveal">
          <h1 class="title">PRTCL 108</h1>
          <div class="subline">
            <span class="dot2"></span>
            <span>multipass scan</span>
            <span style="opacity:.55;">‚Ä¢</span>
            <span>–∫–∞—Ä—Ç–∞ –∏–≥—Ä–æ–∫–∞</span>
            <span style="opacity:.55;">‚Ä¢</span>
            <span>unlock –¥–æ—Å—Ç—É–ø</span>
          </div>

          <p class="lead">
            <b>—ç—Ç–æ –Ω–µ ‚Äú–∫—Ç–æ —Ç—ã‚Äù. —ç—Ç–æ —Ç–≤–æ–π –±–∏–ª–¥.</b><br>
            –∫–æ—Ä–æ—Ç–∫–æ –∏ –ø–æ–Ω—è—Ç–Ω–æ: —Ä–æ–ª—å, —ç–Ω–µ—Ä–≥–∏—è, —Å–∏–ª—å–Ω–∞—è —Å—Ç–æ—Ä–æ–Ω–∞ ‚Äî —Å—Ä–∞–∑—É. –æ—Å—Ç–∞–ª—å–Ω–æ–µ –∑–∞–∫—Ä—ã—Ç–æ –¥–æ –¥–æ—Å—Ç—É–ø–∞.
          </p>

          <p class="mini">
            PRTCL 108 —Ñ–∏–∫—Å–∏—Ä—É–µ—Ç –ø–æ—Ä—Ç—Ä–µ—Ç –∏–≥—Ä–æ–∫–∞ –∏–∑ –∫–æ–ª–ª–µ–∫—Ü–∏–∏ <b>144</b> –∏ –≤—ã–¥–∞—ë—Ç MULTIPASS: –º–∏–Ω–∏-–∫–∞—Ä—Ç–∞ + –ø–æ–ª–Ω–∞—è –∫–∞—Ä—Ç–∞.
          </p>

          <div class="proofRow">
            <div class="proof">
              <div class="k"><span class="p"></span> –±–∞–∑–æ–≤—ã–π —Å–∫–∞–Ω</div>
              <div class="v">–±—ã—Å—Ç—Ä—ã–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ –±–µ–∑ –≤–æ–¥—ã.</div>
            </div>
            <div class="proof">
              <div class="k"><span class="p"></span> unlock</div>
              <div class="v">–∑–∞–º–∫–∏ –ø–∞–¥–∞—é—Ç ‚Äî –æ—Ç–∫—Ä—ã–≤–∞—é—Ç—Å—è –¥–µ—Ç–∞–ª–∏.</div>
            </div>
            <div class="proof">
              <div class="k"><span class="p"></span> —ç–∫—Å–ø–æ—Ä—Ç</div>
              <div class="v">—Å–æ—Ö—Ä–∞–Ω—è–π MULTIPASS –≤ PNG/PDF.</div>
            </div>
          </div>

          <div class="mini" style="margin-top:14px;">
            <span style="opacity:.7">–≤–≤–æ–¥ –∑–∞–Ω–∏–º–∞–µ—Ç</span> <b>60 —Å–µ–∫—É–Ω–¥</b>.
            <span style="opacity:.7">MULTIPASS ‚Äî —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ —Å–∫–∞–Ω–∞.</span>
          </div>
        </div>

        <!-- Right -->
        <div class="pane reveal">
          <div class="formTitle">
            <span>–í–•–û–î –í –°–ö–ê–ù</span>
            <span class="statusPill" id="pill">waiting</span>
          </div>

          <label>–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è</label>
          <input id="dob" type="date" />

          <div class="row">
            <div>
              <label>–í—Ä–µ–º—è (–µ—Å–ª–∏ –∑–Ω–∞–µ—à—å)</label>
              <input id="tob" type="time" placeholder="--:--" />
            </div>
            <div>
              <label>–¢–∞–π–º–∑–æ–Ω–∞</label>
              <select id="tz">
                <option value="+03:00">UTC+03</option>
                <option value="+02:00">UTC+02</option>
                <option value="+01:00">UTC+01</option>
                <option value="+00:00">UTC+00</option>
                <option value="-01:00">UTC-01</option>
                <option value="-02:00">UTC-02</option>
                <option value="-03:00">UTC-03</option>
                <option value="-04:00">UTC-04</option>
                <option value="-05:00">UTC-05</option>
                <option value="-06:00">UTC-06</option>
                <option value="-07:00">UTC-07</option>
                <option value="-08:00">UTC-08</option>
              </select>
            </div>
          </div>

          <label>–ì–æ—Ä–æ–¥ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)</label>
          <input id="place" type="text" placeholder="–Ω–∞–ø—Ä–∏–º–µ—Ä: –ú–æ—Å–∫–≤–∞" />

          <button class="cta" id="go">SCAN MULTIPASS</button>

          <div class="mini" style="margin-top:12px;">
            —Å–∫–∞–Ω –≤—ã–¥–∞—ë—Ç: <b>—Ä–æ–ª—å</b>, <b>—ç–Ω–µ—Ä–≥–∏—é</b>, <b>—Ä–µ–¥–∫–æ—Å—Ç—å</b>, <b>–∫–≤–µ—Å—Ç</b>.
            –¥–µ—Ç–∞–ª–∏ ‚Äî –ø–æ–¥ –∑–∞–º–∫–æ–º.
          </div>

          <div class="mini" style="margin-top:10px; opacity:.78">
            –ø–æ—Ä—Ç—Ä–µ—Ç –∑–∞–∫—Ä–µ–ø–ª—è–µ—Ç—Å—è –Ω–∞ –æ—Å–Ω–æ–≤–µ –≤–≤–æ–¥–∞ (–¥–∞—Ç–∞/–≤—Ä–µ–º—è) –∏ –æ—Å—Ç–∞—ë—Ç—Å—è —Å—Ç–∞–±–∏–ª—å–Ω—ã–º.
          </div>
        </div>
      </div>
    </section>

    <!-- WHAT YOU GET (light edited naming) -->
    <section class="section reveal">
      <h2>—á—Ç–æ —Ç—ã –ø–æ–ª—É—á–∏—à—å</h2>
      <div class="grid">
        <div class="card">
          <div class="tag"><span class="tDot"></span> BASIC</div>
          <div class="text">
            –±–∞–∑–æ–≤—ã–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ –∏ MULTIPASS: –±—ã—Å—Ç—Ä–æ, –ø–æ–Ω—è—Ç–Ω–æ, –±–µ–∑ –ø–∞—Ñ–æ—Å–∞.
          </div>
          <ul class="list">
            <li>—Ä–æ–ª—å –∏ —ç–Ω–µ—Ä–≥–∏—è</li>
            <li>—Ä–µ–¥–∫–æ—Å—Ç—å –∏ –Ω–æ–º–µ—Ä –∏–∑ 144</li>
            <li>–æ–¥–Ω–∞ –∑–∞–¥–∞—á–∞ ‚Äú—Å–µ–π—á–∞—Å‚Äù</li>
          </ul>
        </div>

        <div class="card">
          <div class="tag"><span class="tDot"></span> LOCK</div>
          <div class="text">
            —á–∞—Å—Ç—å —Å—Ç—Ä–æ–∫ –∑–∞–∫—Ä—ã—Ç–∞ –∑–∞–º–∫–æ–º ‚Äî —ç—Ç–æ –Ω–∞–º–µ—Ä–µ–Ω–Ω–æ. —á—Ç–æ–±—ã –æ—Ç–¥–µ–ª–∏—Ç—å ‚Äú—É–∑–Ω–∞—Ç—å‚Äù –æ—Ç ‚Äú–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å‚Äù.
          </div>
          <ul class="list">
            <li>–∫–∞–∫ –¥–µ–π—Å—Ç–≤—É–µ—à—å</li>
            <li>—á—Ç–æ —Ç—Ä–∏–≥–≥–µ—Ä–∏—Ç</li>
            <li>—á—Ç–æ –∫–∞—á–∞—Ç—å</li>
          </ul>
        </div>

        <div class="card">
          <div class="tag"><span class="tDot"></span> EXPORT</div>
          <div class="text">
            —Å–æ—Ö—Ä–∞–Ω—è–π MULTIPASS (mini + full) –≤ PNG –∏–ª–∏ PDF.
          </div>
          <ul class="list">
            <li>PNG –¥–ª—è —Å—Ç–æ—Ä–∏—Å</li>
            <li>PDF –¥–ª—è –∞—Ä—Ö–∏–≤–∞</li>
            <li>–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö</li>
          </ul>
        </div>

        <div class="card wide">
          <div class="tag"><span class="tDot"></span> –ø—Ä–∞–≤–∏–ª–æ</div>
          <div class="text">
            PRTCL 108 ‚Äî —ç—Ç–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å. –±–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏–π ‚Äú—É—á–µ–Ω–∏–π‚Äù, –±–µ–∑ –æ–±—ä—è—Å–Ω–µ–Ω–∏–π ‚Äú–æ—Ç–∫—É–¥–∞‚Äù.
            —Ç–æ–ª—å–∫–æ —Å–∫–∞–Ω, –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∏ –¥–æ—Å—Ç—É–ø.
          </div>
        </div>
      </div>
    </section>

    <div class="footer">
      PRTCL 108 ‚Äî –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∫–∞—Ä—Ç—ã –∏–≥—Ä–æ–∫–∞. –Ω–µ –º–µ–¥–∏—Ü–∏–Ω–∞. –Ω–µ —Ç–µ—Ä–∞–ø–∏—è. –Ω–µ –≥–∞–¥–∞–Ω–∏–µ.
    </div>
  </div>

  <!-- MULTIPASS MODAL -->
  <div class="modalBack" id="modalBack" role="dialog" aria-modal="true" aria-label="MULTIPASS">
    <div class="modal">
      <div class="modalHead">
        <div class="modalTitle">
          <span class="dot2"></span>
          <span>PRTCL 108 / multipass</span>
        </div>
        <button class="close" id="closeModal">close</button>
      </div>

      <div class="modalBody">
        <div class="stack">
          <!-- MINI -->
          <div class="pass" id="miniCard">
            <div class="miniPass">
              <div class="miniHead">
                <div>
                  <div class="miniHeadTitle">
                    <div class="t1">MULTIPASS</div>
                    <div class="t2">
                      <div class="badgeRow">
                        <span class="rarityBadge" id="rarityBadgeMini">
                          <span class="rarityDot"></span>
                          <span id="rarityTextMini">COMMON</span>
                        </span>
                        <span class="rarityBadge" style="gap:6px;">
                          <span style="opacity:.75">‚Ññ</span>
                          <span id="p_no">‚Äî</span><span style="opacity:.65">/144</span>
                        </span>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="seal" aria-hidden="true"></div>
              </div>

              <div class="avatarFace" title="–ø–æ—Ä—Ç—Ä–µ—Ç">
                <img id="faceImg" src="" alt="–ø–æ—Ä—Ç—Ä–µ—Ç –∏–≥—Ä–æ–∫–∞">
              </div>

              <div class="miniInfo">
                <div class="kv">
                  <div class="k">id</div>
                  <div class="v" id="p_id">‚Äî</div>
                </div>
                <div class="kv">
                  <div class="k">–¥–æ—Å—Ç—É–ø</div>
                  <div class="v" id="p_access">BASIC</div>
                </div>
                <div class="kv">
                  <div class="k">—Ä–æ–ª—å</div>
                  <div class="v" id="p_role">‚Äî</div>
                </div>
                <div class="kv">
                  <div class="k">—ç–Ω–µ—Ä–≥–∏—è</div>
                  <div class="v" id="p_energy">‚Äî</div>
                </div>
              </div>

              <div class="miniFoot">
                <div class="protoSig" id="p_sig">prtc108 // signed</div>
                <div id="p_time">‚Äî</div>
              </div>
            </div>
          </div>

          <!-- FULL -->
          <div class="pass" id="fullCard">
            <div class="fullPass">
              <div class="fullHead">
                <div>
                  <div class="t1">
                    FULL PLAYER CARD
                    <span class="rarityBadge" id="rarityBadgeFull">
                      <span class="rarityDot"></span>
                      <span id="rarityTextFull">COMMON</span>
                    </span>
                    <span class="rarityBadge" style="gap:6px;">
                      <span style="opacity:.75">‚Ññ</span>
                      <span id="p_no2">‚Äî</span><span style="opacity:.65">/144</span>
                    </span>
                  </div>
                  <div class="t2">—Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏</div>
                </div>
                <div class="seal" aria-hidden="true"></div>
              </div>

              <div class="fullBody">
                <div class="avatarFull" title="–ø–æ—Ä—Ç—Ä–µ—Ç">
                  <img id="fullImg" src="" alt="–ø–æ—Ä—Ç—Ä–µ—Ç –∏–≥—Ä–æ–∫–∞">
                </div>

                <div class="stats" id="statsBox">
                  <div class="line reveal"><b>–†–æ–ª—å:</b> <span id="d_role">‚Äî</span></div>
                  <div class="line reveal"><b>–≠–Ω–µ—Ä–≥–∏—è:</b> <span id="d_energy">‚Äî</span></div>

                  <div class="line locked reveal" data-lock="1"><b>–ö–∞–∫ –¥–µ–π—Å—Ç–≤—É–µ—à—å:</b> <span id="d_action">‚Äî</span></div>
                  <div class="line locked reveal" data-lock="1"><b>–û–±—â–µ–Ω–∏–µ:</b> <span id="d_social">‚Äî</span></div>
                  <div class="line locked reveal" data-lock="1"><b>–°–∏–ª—å–Ω–∞—è —Å—Ç–æ—Ä–æ–Ω–∞:</b> <span id="d_strong">‚Äî</span></div>
                  <div class="line locked reveal" data-lock="1"><b>–°–ª–∞–±–æ–µ –º–µ—Å—Ç–æ:</b> <span id="d_weak">‚Äî</span></div>
                  <div class="line locked reveal" data-lock="1"><b>–¢—Ä–∏–≥–≥–µ—Ä:</b> <span id="d_trigger">‚Äî</span></div>
                  <div class="line locked reveal" data-lock="1"><b>–ù–∞–≤—ã–∫:</b> <span id="d_skill">‚Äî</span></div>
                  <div class="line locked reveal" data-lock="1"><b>–ë–æ–Ω—É—Å:</b> <span id="d_bonus">‚Äî</span></div>
                  <div class="line locked reveal" data-lock="1"><b>–ó–∞–¥–∞—á–∞ —Å–µ–π—á–∞—Å:</b> <span id="d_quest">‚Äî</span></div>
                </div>
              </div>

              <div class="btnRow">
                <button class="btn2 primary" id="unlockBtn">unlock</button>
                <button class="btn2 primary" id="exportPngBtn">export png</button>
                <button class="btn2 primary" id="exportPdfBtn">export pdf</button>
                <button class="btn2" id="regenBtn">rescan</button>
              </div>

              <div class="mini" style="margin-top:10px;">
                BASIC –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –±–∞–∑—É. UNLOCK –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç —Å–∫—Ä—ã—Ç—ã–µ —Å—Ç—Ä–æ–∫–∏.
              </div>
            </div>
          </div>
        </div>

        <!-- RIGHT TERMINAL -->
        <div class="panel">
          <div class="panelHead">
            <div class="panelTitle">terminal / output</div>
            <div class="lights" aria-hidden="true"><span></span><span></span><span></span></div>
          </div>
          <div class="panelBody">
<pre class="log" id="termOut"><span class="muted">[scan]</span> waiting...</pre>
            <div class="btnRow">
              <button class="btn2 primary" id="unlockBtn2">unlock</button>
              <button class="btn2" id="copyBtn">copy</button>
            </div>
            <div class="mini" style="margin-top:10px; opacity:.78">
              –æ–ø–ª–∞—Ç—É –ø–æ–¥–∫–ª—é—á–∏–º –ø–æ–∑–∂–µ ‚Äî —Å–µ–π—á–∞—Å —ç—Ç–æ –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –º–µ—Ö–∞–Ω–∏–∫–∏ –¥–æ—Å—Ç—É–ø–∞.
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    /* ========= Core logic (PRTCL 108) ========= */

    const $ = (id)=>document.getElementById(id);
    const hero = $("hero");
    const pill = $("pill");
    const modalBack = $("modalBack");
    const termOut = $("termOut");

    // portraits
    const PORTRAITS_COUNT = 144;
    function pad3(n){ return String(n).padStart(3,"0"); }
    function portraitUrl(idx){ return `assets/portraits/p${pad3(idx)}.jpg`; }

    // rarity by index (collection logic)
    // 1-6 MYTHIC, 7-24 EPIC, 25-60 RARE, 61-144 COMMON
    function rarityByIndex(idx){
      if(idx <= 6) return "MYTHIC";
      if(idx <= 24) return "EPIC";
      if(idx <= 60) return "RARE";
      return "COMMON";
    }

    // role pools per rarity (portrait ‚Üî style)
    const ROLE_COMMON = ["–Ω–∞–±–ª—é–¥–∞—Ç–µ–ª—å","—Å–±–æ—Ä—â–∏–∫","–∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å","–æ—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä","–∏—Å—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å","–ø—Ä–∞–∫—Ç–∏–∫"];
    const ROLE_RARE   = ["—Å—Ç—Ä–∞—Ç–µ–≥","–ø—Ä–æ–≤–æ–¥–Ω–∏–∫","—É—Å–∫–æ—Ä–∏—Ç–µ–ª—å","—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ç–æ—Ä","–º–µ–¥–∏–∞—Ç–æ—Ä","–∞—Ä—Ö–∏—Ç–µ–∫—Ç–æ—Ä"];
    const ROLE_EPIC   = ["–∫–æ–Ω—Ç—Ä–æ–ª—ë—Ä —Ö–∞–æ—Å–∞","–∏–≥—Ä–æ–∫ –Ω–∞ –≥—Ä–∞–Ω–∏","–º–∞—Å—Ç–µ—Ä —Ñ–æ–∫—É—Å–∞","—Å–æ–±–∏—Ä–∞—Ç–µ–ª—å –≤–ª–∏—è–Ω–∏—è"];
    const ROLE_MYTHIC = ["–ø–µ—Ä–µ–ª–æ–º—â–∏–∫ –ø—Ä–∞–≤–∏–ª","—è–¥—Ä–æ –ø—Ä–æ—Ç–æ–∫–æ–ª–∞","–Ω–æ—Å–∏—Ç–µ–ª—å –¥–æ—Å—Ç—É–ø–∞"];

    const ENERGY = ["—Ä–æ–≤–Ω–∞—è","—Ä—ã–≤–∫–∞–º–∏","–≤—ã—Å–æ–∫–∞—è","–±–µ—Ä–µ–∂–Ω–∞—è","—Ç–≤–æ—Ä—á–µ—Å–∫–∞—è","–±–æ–µ–≤–æ–π —Ä–µ–∂–∏–º"];
    const ACTION = ["—Å–Ω–∞—á–∞–ª–∞ –¥—É–º–∞—é, –ø–æ—Ç–æ–º –¥–µ–ª–∞—é","–¥–µ–ª–∞—é –±—ã—Å—Ç—Ä–æ, –ø–æ—Ç–æ–º –ø—Ä–∞–≤–ª—é","–¥–µ–ª–∞—é —Ç–æ–ª—å–∫–æ –∫–æ–≥–¥–∞ —è—Å–Ω–æ","–¥–µ–ª–∞—é —á–µ—Ä–µ–∑ –≤–¥–æ—Ö–Ω–æ–≤–µ–Ω–∏–µ"];
    const SOCIAL = ["—É–∑–∫–∏–π –∫—Ä—É–≥","–ª–µ–≥–∫–æ –∑–Ω–∞–∫–æ–º–ª—é—Å—å","–º–Ω–µ –Ω—É–∂–Ω–∞ –¥–∏—Å—Ç–∞–Ω—Ü–∏—è","—è –≤–µ–¥—É —Ä–∞–∑–≥–æ–≤–æ—Ä","—è –º—è–≥–∫–æ –≤–µ–¥—É"];
    const STRONG = ["—è—Å–Ω–æ—Å—Ç—å","—Å–∫–æ—Ä–æ—Å—Ç—å","–∏–Ω—Ç—É–∏—Ü–∏—è","–≤—ã–¥–µ—Ä–∂–∫–∞","–≤–ª–∏—è–Ω–∏–µ","—á–µ—Å—Ç–Ω–æ—Å—Ç—å"];
    const WEAK   = ["–ø–µ—Ä–µ–≥—Ä—É–∑","—Å–∞–º–æ–∫—Ä–∏—Ç–∏–∫–∞","–æ—Ç–∫–ª–∞–¥—ã–≤–∞–Ω–∏–µ","—Ä–µ–∑–∫–æ—Å—Ç—å","—É—Å—Ç–∞–ª–æ—Å—Ç—å","—ç–º–æ-–∫–∞—á–µ–ª–∏"];
    const TRIG   = ["–¥–∞–≤–ª–µ–Ω–∏–µ","–∫–æ–Ω—Ç—Ä–æ–ª—å","–Ω–µ–æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ—Å—Ç—å","–Ω–µ—Å–ø—Ä–∞–≤–µ–¥–ª–∏–≤–æ—Å—Ç—å","—Ö–∞–æ—Å","–æ–±–µ—Å—Ü–µ–Ω–∏–≤–∞–Ω–∏–µ"];
    const SKILL  = ["–¥–µ—Ä–∂–∞—Ç—å –≥—Ä–∞–Ω–∏—Ü—ã","–≤–∏–¥–µ—Ç—å —Å—É—Ç—å","—Ä–µ–∑–∞—Ç—å –ª–∏—à–Ω–µ–µ","—Å–æ–±–∏—Ä–∞—Ç—å –ø–ª–∞–Ω","–ø–æ–¥–Ω–∏–º–∞—Ç—å —Å–µ–±—è","–≤–µ—Å—Ç–∏ –ª—é–¥–µ–π"];
    const BONUS  = ["—á—É–≤—Å—Ç–≤–æ –ø—Ä–∞–≤–¥—ã","+—Ñ–æ–∫—É—Å","+—Å–∫–æ—Ä–æ—Å—Ç—å –æ–±—É—á–µ–Ω–∏—è","+—Å—Ç–æ–π–∫–æ—Å—Ç—å","+–∏–Ω—Ç—É–∏—Ü–∏—è"];
    const QUEST  = ["–Ω–∞—Å—Ç—Ä–æ–∏—Ç—å —Ä–µ–∂–∏–º","–ø–æ—á–∏—Å—Ç–∏—Ç—å –æ–∫—Ä—É–∂–µ–Ω–∏–µ","—Å–æ–±—Ä–∞—Ç—å —Ü–µ–ª—å","—É—Å–∏–ª–∏—Ç—å —Ç–µ–ª–æ","–≤—ã—Å—Ç—Ä–æ–∏—Ç—å –¥–µ–Ω—å–≥–∏","—Å–¥–µ–ª–∞—Ç—å —à–∞–≥ –≤ –Ω–æ–≤–æ–µ"];

    function pick(list, seed){ return list[seed % list.length]; }

    // deterministic seed
    function hashLike(str){
      let h = 2166136261;
      for(let i=0;i<str.length;i++){
        h ^= str.charCodeAt(i);
        h = Math.imul(h, 16777619);
      }
      return (h>>>0);
    }

    function pad2(n){ return String(n).padStart(2,"0"); }
    function nowStamp(){
      const d = new Date();
      return `${d.getFullYear()}-${pad2(d.getMonth()+1)}-${pad2(d.getDate())} ${pad2(d.getHours())}:${pad2(d.getMinutes())}`;
    }

    function canScan(){
      return $("dob").value.trim().length > 0;
    }

    function setPill(){
      pill.textContent = canScan() ? "ready" : "waiting";
    }
    ["dob","tob","tz","place"].forEach(id => $(id).addEventListener("input", setPill));
    setPill();

    // lock / unlock
    let unlocked = false;
    function applyUnlockState(){
      document.querySelectorAll("[data-lock='1']").forEach((el, i)=>{
        if(unlocked){
          el.classList.add("unlocked");
          setTimeout(()=>{ el.classList.remove("locked"); }, 140 + i*35);
        }else{
          el.classList.add("locked");
          el.classList.remove("unlocked");
        }
      });
      $("p_access").textContent = unlocked ? "FULL" : "BASIC";
    }

    function setRarityUI(rarity){
      const mapClass = {
        "COMMON":"rarityCommon",
        "RARE":"rarityRare",
        "EPIC":"rarityEpic",
        "MYTHIC":"rarityMythic"
      };
      const b1 = $("rarityBadgeMini");
      const b2 = $("rarityBadgeFull");
      b1.className = "rarityBadge " + mapClass[rarity];
      b2.className = "rarityBadge " + mapClass[rarity];
      $("rarityTextMini").textContent = rarity;
      $("rarityTextFull").textContent = rarity;
    }

    function buildPayload(){
      const dob = $("dob").value.trim();
      const tob = ($("tob").value.trim() || "00:00");
      const tz  = $("tz").value;
      const place = $("place").value.trim();

      const seed = hashLike(`${dob}|${tob}|${tz}|${place}|PRTCL108`);
      const idx = (seed % PORTRAITS_COUNT) + 1;
      const rarity = rarityByIndex(idx);

      let rolePool = ROLE_COMMON;
      if(rarity === "RARE") rolePool = ROLE_RARE;
      if(rarity === "EPIC") rolePool = ROLE_EPIC;
      if(rarity === "MYTHIC") rolePool = ROLE_MYTHIC;

      const role = pick(rolePool, seed >>> 1);
      const energy = pick(ENERGY, seed >>> 2);
      const action = pick(ACTION, seed >>> 3);
      const social = pick(SOCIAL, seed >>> 4);
      const strong = pick(STRONG, seed >>> 5);
      const weak   = pick(WEAK,   seed >>> 6);
      const trigger= pick(TRIG,   seed >>> 7);
      const skill  = pick(SKILL,  seed >>> 8);
      let bonus    = pick(BONUS,  seed >>> 9);
      let quest    = pick(QUEST,  seed >>> 10);

      if(rarity === "EPIC") bonus = bonus + " (—É—Å–∏–ª–µ–Ω–æ)";
      if(rarity === "MYTHIC") { bonus = bonus + " (–º–∞–∫—Å–∏–º—É–º)"; quest = "—É—Ä–æ–≤–µ–Ω—å –¥–æ—Å—Ç—É–ø–∞"; }

      return {
        dob, tob, tz, place,
        seed,
        id: "PRT-" + String(seed).slice(0,10),
        portraitIndex: idx,
        portraitUrl: portraitUrl(idx),
        rarity,
        role, energy, action, social, strong, weak, trigger, skill, bonus, quest,
        sig: "prtc108 // signed",
        time: nowStamp()
      };
    }

    function render(p){
      $("faceImg").src = p.portraitUrl;
      $("fullImg").src = p.portraitUrl;

      $("p_no").textContent = pad3(p.portraitIndex);
      $("p_no2").textContent = pad3(p.portraitIndex);

      $("p_id").textContent = p.id;
      $("p_role").textContent = p.role;
      $("p_energy").textContent = p.energy;
      $("p_sig").textContent = p.sig;
      $("p_time").textContent = p.time;

      $("d_role").textContent = p.role;
      $("d_energy").textContent = p.energy;
      $("d_action").textContent = p.action;
      $("d_social").textContent = p.social;
      $("d_strong").textContent = p.strong;
      $("d_weak").textContent = p.weak;
      $("d_trigger").textContent = p.trigger;
      $("d_skill").textContent = p.skill;
      $("d_bonus").textContent = p.bonus;
      $("d_quest").textContent = p.quest;

      setRarityUI(p.rarity);

      termOut.innerHTML =
`<span class="muted">[prtc108]</span> <span class="ok">scan complete</span>
<span class="muted">[input]</span> dob=${p.dob}  tob=${(p.tob==="00:00" ? "‚Äî" : p.tob)}  tz=${p.tz}  place=${p.place||"‚Äî"}
<span class="muted">[id]</span> ${p.id}
<span class="muted">[portrait]</span> #${pad3(p.portraitIndex)}/144 (${p.rarity})
<span class="muted">[basic]</span> role=${p.role} | energy=${p.energy}
<span class="muted">[locked]</span> details locked until unlock
<span class="muted">[sig]</span> ${p.sig}
<span class="muted">[time]</span> ${p.time}`;

      // reveal animation reset
      document.querySelectorAll(".line").forEach((el, i)=>{
        el.classList.remove("reveal");
        void el.offsetWidth;
        setTimeout(()=> el.classList.add("reveal"), 20 + i*30);
      });

      applyUnlockState();
    }

    function openModal(){
      modalBack.classList.add("show");
      document.body.style.overflow = "hidden";
    }
    function closeModal(){
      modalBack.classList.remove("show");
      document.body.style.overflow = "";
    }
    $("closeModal").addEventListener("click", closeModal);
    modalBack.addEventListener("click",(e)=>{ if(e.target===modalBack) closeModal(); });

    let lastPayload = null;

    function startScan(){
      if(!canScan()){
        alert("–≤–≤–µ–¥–∏ –¥–∞—Ç—É —Ä–æ–∂–¥–µ–Ω–∏—è.");
        return;
      }

      unlocked = false;
      applyUnlockState();

      hero.classList.add("scanning");
      setTimeout(()=> hero.classList.remove("scanning"), 1300);

      // light scan delay for Apple feel
      setTimeout(()=>{
        const p = buildPayload();
        lastPayload = p;
        render(p);
        openModal();
      }, 860);
    }

    $("go").addEventListener("click", startScan);

    $("regenBtn").addEventListener("click", ()=>{
      if(!canScan()) return;
      unlocked = false;
      const p = buildPayload();
      lastPayload = p;
      render(p);
    });

    function doUnlock(){
      unlocked = true;
      applyUnlockState();
      termOut.innerHTML += `\n<span class="muted">[unlock]</span> <span class="ok">granted</span>`;
    }
    $("unlockBtn").addEventListener("click", doUnlock);
    $("unlockBtn2").addEventListener("click", doUnlock);

    // Copy
    $("copyBtn").addEventListener("click", async ()=>{
      if(!lastPayload) return;
      const p = lastPayload;
      const t =
`PRTCL 108 ‚Äî MULTIPASS
‚Ññ: ${pad3(p.portraitIndex)}/144 (${p.rarity})
ID: ${p.id}
–†–æ–ª—å: ${p.role}
–≠–Ω–µ—Ä–≥–∏—è: ${p.energy}
${unlocked ? `–ö–∞–∫ –¥–µ–π—Å—Ç–≤—É–µ—à—å: ${p.action}
–û–±—â–µ–Ω–∏–µ: ${p.social}
–°–∏–ª—å–Ω–∞—è —Å—Ç–æ—Ä–æ–Ω–∞: ${p.strong}
–°–ª–∞–±–æ–µ –º–µ—Å—Ç–æ: ${p.weak}
–¢—Ä–∏–≥–≥–µ—Ä: ${p.trigger}
–ù–∞–≤—ã–∫: ${p.skill}
–ë–æ–Ω—É—Å: ${p.bonus}
–ó–∞–¥–∞—á–∞: ${p.quest}` : `DETAILS: locked`}
–ü–æ–¥–ø–∏—Å—å: ${p.sig}
–í—Ä–µ–º—è: ${p.time}`;
      try{
        await navigator.clipboard.writeText(t);
        termOut.innerHTML += `\n<span class="muted">[clipboard]</span> <span class="ok">copied</span>`;
      }catch(e){
        termOut.innerHTML += `\n<span class="muted">[clipboard]</span> <span class="warn">blocked</span>`;
      }
    });

    // Export PNG/PDF
    async function nodeToPngDataUrl(node){
      const canvas = await html2canvas(node, {backgroundColor: null, scale: 2});
      return canvas.toDataURL("image/png");
    }
    function downloadDataUrl(dataUrl, filename){
      const a = document.createElement("a");
      a.href = dataUrl;
      a.download = filename;
      document.body.appendChild(a);
      a.click();
      a.remove();
    }

    $("exportPngBtn").addEventListener("click", async ()=>{
      if(!lastPayload) return;
      const n = pad3(lastPayload.portraitIndex);
      const d1 = await nodeToPngDataUrl($("miniCard"));
      const d2 = await nodeToPngDataUrl($("fullCard"));
      downloadDataUrl(d1, `PRTCL108_MULTIPASS_${n}_mini.png`);
      downloadDataUrl(d2, `PRTCL108_MULTIPASS_${n}_full.png`);
      termOut.innerHTML += `\n<span class="muted">[export]</span> <span class="ok">png saved</span>`;
    });

    $("exportPdfBtn").addEventListener("click", async ()=>{
      if(!lastPayload) return;
      const { jsPDF } = window.jspdf;
      const n = pad3(lastPayload.portraitIndex);
      const d1 = await nodeToPngDataUrl($("miniCard"));
      const d2 = await nodeToPngDataUrl($("fullCard"));

      const pdf = new jsPDF({ orientation:"p", unit:"pt", format:"a4" });
      const pageW = pdf.internal.pageSize.getWidth();
      const margin = 28;
      const maxW = pageW - margin*2;

      const img1 = new Image(); img1.src = d1;
      const img2 = new Image(); img2.src = d2;
      await new Promise(r=> img1.onload = r);
      await new Promise(r=> img2.onload = r);

      const h1 = (img1.height / img1.width) * maxW;
      const h2 = (img2.height / img2.width) * maxW;

      let y = margin;
      pdf.addImage(d1, "PNG", margin, y, maxW, h1);
      y += h1 + 18;
      pdf.addImage(d2, "PNG", margin, y, maxW, h2);

      pdf.save(`PRTCL108_MULTIPASS_${n}.pdf`);
      termOut.innerHTML += `\n<span class="muted">[export]</span> <span class="ok">pdf saved</span>`;
    });

    // Scroll reveal
    const obs = new IntersectionObserver((entries)=>{
      entries.forEach(e=>{
        if(e.isIntersecting) e.target.classList.add("show");
      });
    }, {threshold: 0.12});
    document.querySelectorAll(".reveal").forEach(el=>obs.observe(el));

    // Particles (pearl)
    const c = document.getElementById("particles");
    const ctx = c.getContext("2d");
    let W, H, DPR;

    function resize(){
      DPR = Math.min(window.devicePixelRatio || 1, 2);
      W = c.width = Math.floor(window.innerWidth * DPR);
      H = c.height = Math.floor(window.innerHeight * DPR);
      c.style.width = window.innerWidth + "px";
      c.style.height = window.innerHeight + "px";
    }
    window.addEventListener("resize", resize);
    resize();

    const rand = (a,b)=>a+Math.random()*(b-a);
    const dots = Array.from({length: 60}, ()=>({
      x: rand(0, W), y: rand(0, H),
      r: rand(0.8, 2.2) * DPR,
      vx: rand(-0.18, 0.18) * DPR,
      vy: rand(-0.14, 0.14) * DPR,
      a: rand(0.08, 0.22),
      hue: rand(230, 285)
    }));

    function step(){
      ctx.clearRect(0,0,W,H);
      for(const d of dots){
        d.x += d.vx; d.y += d.vy;
        if(d.x < -40) d.x = W+40;
        if(d.x > W+40) d.x = -40;
        if(d.y < -40) d.y = H+40;
        if(d.y > H+40) d.y = -40;

        const g = ctx.createRadialGradient(d.x, d.y, 0, d.x, d.y, d.r*8);
        g.addColorStop(0, `hsla(${d.hue}, 100%, 90%, ${d.a})`);
        g.addColorStop(1, `hsla(${d.hue}, 100%, 90%, 0)`);
        ctx.fillStyle = g;
        ctx.beginPath();
        ctx.arc(d.x, d.y, d.r*8, 0, Math.PI*2);
        ctx.fill();

        ctx.fillStyle = `rgba(255,255,255,${Math.min(d.a*2,0.35)})`;
        ctx.beginPath();
        ctx.arc(d.x, d.y, d.r, 0, Math.PI*2);
        ctx.fill();
      }
      requestAnimationFrame(step);
    }
    step();
  </script>
</body>
</html>
