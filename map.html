<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>OFF SCRIPT — HUD</title>
  <meta name="description" content="OFF SCRIPT — карта игрока. Скан завершён: CORE, LOOPS, QUEST, ENERGY, SETTINGS." />

  <style>
    :root{
      --bg:#060812;
      --ink:#EAF6FF;
      --muted: rgba(234,246,255,.74);

      --stroke: rgba(120,255,240,.26);
      --stroke2: rgba(120,255,240,.14);

      --a:#76FFF0;   /* cyan */
      --b:#FFB35C;   /* amber */
      --c:#B86BFF;   /* violet */
      --d:#FF5C8A;   /* pink */
      --ok:#7CFF7C;

      --shadow: 0 18px 70px rgba(0,0,0,.55);
      --r:22px;
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
      color:var(--ink);
      background:
        radial-gradient(1100px 600px at 18% 12%, rgba(118,255,240,.14), transparent 60%),
        radial-gradient(900px 520px at 82% 22%, rgba(255,179,92,.12), transparent 62%),
        radial-gradient(1000px 700px at 60% 86%, rgba(184,107,255,.12), transparent 65%),
        radial-gradient(700px 600px at 40% 70%, rgba(255,92,138,.08), transparent 62%),
        linear-gradient(180deg, #050712 0%, #070A16 45%, #050712 100%);
      overflow-x:hidden;
    }

    /* FX LAYERS */
    .fx{position:fixed; inset:0; pointer-events:none; z-index:0;}
    .fx.stars{
      opacity:.42; mix-blend-mode: screen;
      background-image:
        radial-gradient(1px 1px at 10% 20%, rgba(255,255,255,.35) 50%, transparent 52%),
        radial-gradient(1px 1px at 30% 80%, rgba(255,255,255,.25) 50%, transparent 52%),
        radial-gradient(1px 1px at 70% 30%, rgba(255,255,255,.22) 50%, transparent 52%),
        radial-gradient(1px 1px at 90% 60%, rgba(255,255,255,.18) 50%, transparent 52%),
        radial-gradient(1px 1px at 55% 10%, rgba(255,255,255,.20) 50%, transparent 52%),
        radial-gradient(1px 1px at 15% 65%, rgba(255,255,255,.14) 50%, transparent 52%);
      filter: blur(.25px);
    }
    .fx.scanlines{
      opacity:.10;
      background: repeating-linear-gradient(
        to bottom,
        rgba(255,255,255,.06) 0px,
        rgba(255,255,255,.06) 1px,
        transparent 2px,
        transparent 6px
      );
      mix-blend-mode: overlay;
    }
    .fx.vignette{
      background: radial-gradient(80% 70% at 50% 40%, transparent 55%, rgba(0,0,0,.55) 100%);
      opacity:.55;
    }

    .wrap{
      position:relative;
      z-index:1;
      max-width: 1160px;
      margin: 0 auto;
      padding: 26px 18px 90px;
    }

    /* TOPBAR */
    .topbar{
      display:flex; align-items:center; justify-content:space-between;
      gap:12px; flex-wrap:wrap;
      margin-bottom: 14px;
    }
    .brand{display:flex; align-items:center; gap:12px; user-select:none;}
    .sig{
      width:38px; height:38px; border-radius:12px;
      border:1px solid rgba(120,255,240,.35);
      background:
        radial-gradient(22px 18px at 30% 30%, rgba(118,255,240,.35), transparent 60%),
        radial-gradient(22px 18px at 70% 70%, rgba(255,179,92,.22), transparent 60%),
        rgba(0,0,0,.22);
      box-shadow: 0 0 18px rgba(118,255,240,.18);
      position:relative; overflow:hidden;
    }
    .sig:after{
      content:"";
      position:absolute; inset:-20%;
      background: conic-gradient(from 180deg, transparent, rgba(118,255,240,.22), transparent);
      animation: spin 5.5s linear infinite;
      opacity:.75;
    }
    @keyframes spin{to{transform:rotate(360deg)}}

    .chip{
      font-size:12px;
      color:rgba(234,246,255,.74);
      border:1px solid rgba(120,255,240,.18);
      border-radius:999px;
      padding:6px 10px;
      background: rgba(0,0,0,.20);
      white-space:nowrap;
    }
    .chip b{color:rgba(234,246,255,.92)}
    .mono{font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;}

    .btn{
      display:inline-flex; align-items:center; justify-content:center;
      padding: 12px 14px;
      border-radius: 14px;
      border:1px solid rgba(118,255,240,.35);
      background: linear-gradient(90deg, rgba(118,255,240,.18), rgba(184,107,255,.14), rgba(255,179,92,.14));
      color: rgba(234,246,255,.95);
      font-weight:900;
      letter-spacing:.12em;
      text-transform:uppercase;
      cursor:pointer;
      box-shadow: 0 0 28px rgba(118,255,240,.12);
      user-select:none;
      text-decoration:none;
      transition: transform .12s ease, filter .12s ease;
    }
    .btn:hover{filter:brightness(1.06)}
    .btn:active{transform: translateY(1px)}
    .ghostBtn{
      display:inline-flex; align-items:center; justify-content:center;
      padding: 12px 14px;
      border-radius: 14px;
      border:1px solid rgba(120,255,240,.22);
      background: rgba(0,0,0,.18);
      color: rgba(234,246,255,.90);
      letter-spacing:.10em;
      text-transform:uppercase;
      font-weight:850;
      cursor:pointer;
      user-select:none;
      text-decoration:none;
    }
    .ghostBtn:hover{filter:brightness(1.08)}

    /* HERO (HUD HEADER) */
    .hero{
      border:1px solid rgba(120,255,240,.26);
      border-radius: var(--r);
      background: linear-gradient(180deg, rgba(14,18,33,.72), rgba(10,14,28,.58));
      box-shadow: var(--shadow);
      position:relative;
      overflow:hidden;
      isolation:isolate;
      padding: 18px;
      margin-bottom: 14px;
    }
    .hero:before{
      content:"";
      position:absolute; inset:-2px;
      background:
        radial-gradient(520px 240px at 12% 0%, rgba(118,255,240,.18), transparent 60%),
        radial-gradient(520px 240px at 88% 0%, rgba(255,179,92,.14), transparent 60%),
        radial-gradient(520px 240px at 50% 100%, rgba(184,107,255,.12), transparent 62%);
      pointer-events:none;
      filter: blur(1px);
      z-index:0;
    }
    .heroGrid{
      position:absolute; inset:0;
      pointer-events:none;
      opacity:.22;
      background:
        linear-gradient(to right, rgba(120,255,240,.10) 1px, transparent 1px),
        linear-gradient(to bottom, rgba(120,255,240,.08) 1px, transparent 1px);
      background-size: 64px 64px;
      mix-blend-mode: screen;
      mask: radial-gradient(70% 70% at 50% 35%, #000 55%, transparent 100%);
      z-index:1;
    }

    /* SCAN BEAM */
    .scanBeam{
      position:absolute; inset:0;
      pointer-events:none;
      opacity:0;
      z-index:2;
      background:
        linear-gradient(to bottom,
          transparent 0%,
          transparent 25%,
          rgba(118,255,240,.10) 35%,
          rgba(118,255,240,.55) 50%,
          rgba(255,179,92,.18) 52%,
          transparent 62%,
          transparent 100%
        );
      mix-blend-mode: screen;
      filter: blur(.2px);
    }
    .hero.scanning .scanBeam{
      opacity:1;
      animation: scanPass 2.2s linear infinite;
    }
    @keyframes scanPass{
      from { transform: translateY(-35%); }
      to   { transform: translateY(35%); }
    }

    .heroInner{
      position:relative; z-index:3;
      display:flex; flex-wrap:wrap; gap:14px;
      align-items:flex-start; justify-content:space-between;
    }

    h1{
      margin:0 0 8px;
      letter-spacing:.14em;
      font-weight: 950;
      font-size: 26px;
      text-transform:uppercase;
    }

    /* GLITCH TITLE */
    .glitch{position:relative; text-shadow: 0 0 18px rgba(118,255,240,.14);}
    .glitch:before, .glitch:after{
      content: attr(data-text);
      position:absolute; left:0; top:0;
      opacity:0;
      pointer-events:none;
    }
    .glitch:before{ transform: translateX(1px); color: rgba(255,92,138,.55); }
    .glitch:after { transform: translateX(-1px); color: rgba(118,255,240,.55); }
    @keyframes glitchPulse{
      0%, 92%, 100% { opacity: 0; }
      93% { opacity:.85; clip-path: inset(0 0 60% 0); }
      94% { opacity:.65; clip-path: inset(40% 0 10% 0); }
      95% { opacity: 0; }
    }
    .glitch:before, .glitch:after{ animation: glitchPulse 4.6s infinite; }

    .subline{
      display:flex; align-items:center; gap:10px; flex-wrap:wrap;
      margin: 0;
      color: rgba(234,246,255,.70);
      letter-spacing:.08em;
      text-transform:uppercase;
      font-size:12px;
    }
    .badgeDot{
      width:8px; height:8px; border-radius:50%;
      background: var(--a);
      box-shadow: 0 0 14px rgba(118,255,240,.55);
    }

    .lead{
      margin: 10px 0 0;
      font-size: 14px;
      line-height: 1.6;
      color: rgba(234,246,255,.88);
      max-width: 86ch;
    }
    .lead b{color:rgba(234,246,255,.98)}
    .hint{
      margin-top:10px;
      color:rgba(234,246,255,.72);
      font-size:13px;
      line-height:1.55;
      max-width: 92ch;
    }

    .rightCol{
      display:flex; flex-direction:column; gap:10px;
      min-width: 260px;
      align-items:flex-end;
    }

    /* GRID */
    .grid{
      display:grid;
      grid-template-columns: repeat(12, 1fr);
      gap:14px;
    }
    .card{
      grid-column: span 6;
      border:1px solid rgba(120,255,240,.18);
      border-radius: 18px;
      background: rgba(0,0,0,.18);
      padding: 16px;
      position:relative;
      overflow:hidden;
      opacity:0; /* animated in */
      transform: translateY(10px);
      filter: blur(2px);
      animation: popIn .55s ease-out forwards;
    }
    .card.wide{grid-column: span 12;}
    @media (max-width: 900px){ .card{grid-column: span 12;} }

    /* cascade */
    .card:nth-child(1){animation-delay:.06s}
    .card:nth-child(2){animation-delay:.12s}
    .card:nth-child(3){animation-delay:.16s}
    .card:nth-child(4){animation-delay:.20s}
    .card:nth-child(5){animation-delay:.24s}
    .card:nth-child(6){animation-delay:.28s}
    .card:nth-child(7){animation-delay:.32s}
    .card:nth-child(8){animation-delay:.36s}

    @keyframes popIn{
      to{ opacity:1; transform: translateY(0); filter: blur(0); }
    }

    .card:before{
      content:"";
      position:absolute; inset:-2px;
      background:
        radial-gradient(420px 220px at 0% 0%, rgba(118,255,240,.12), transparent 55%),
        radial-gradient(420px 220px at 100% 0%, rgba(255,179,92,.10), transparent 55%);
      pointer-events:none;
      z-index:0;
    }
    .card > *{position:relative; z-index:1;}

    .card h3{
      margin:0 0 10px;
      letter-spacing:.10em;
      text-transform:uppercase;
      font-size:13px;
    }

    .tag{
      display:inline-flex; align-items:center; gap:8px;
      padding:6px 10px;
      border-radius:999px;
      border:1px solid rgba(120,255,240,.18);
      background: rgba(0,0,0,.18);
      color: rgba(234,246,255,.74);
      font-size:12px;
      margin-bottom:10px;
      user-select:none;
    }
    .dot{
      width:8px; height:8px; border-radius:50%;
      background: var(--a);
      box-shadow: 0 0 12px rgba(118,255,240,.5);
    }
    .dot.b{background: var(--b); box-shadow: 0 0 12px rgba(255,179,92,.45);}
    .dot.c{background: var(--c); box-shadow: 0 0 12px rgba(184,107,255,.45);}
    .dot.d{background: var(--d); box-shadow: 0 0 12px rgba(255,92,138,.45);}

    .line{
      color: rgba(234,246,255,.90);
      line-height:1.6;
      font-size:13.8px;
    }
    .line b{color: rgba(234,246,255,.98);}

    .list{
      margin:10px 0 0;
      padding-left:18px;
      color: rgba(234,246,255,.78);
      line-height:1.6;
      font-size:13.3px;
    }
    .list li{margin:7px 0}

    .callout{
      border:1px solid rgba(255,179,92,.18);
      background: rgba(0,0,0,.18);
      border-radius: 16px;
      padding: 12px;
      color: rgba(234,246,255,.86);
      line-height: 1.6;
      font-size: 13.7px;
    }

    .footer{
      margin-top:16px;
      font-size:12px;
      color: rgba(234,246,255,.58);
      line-height:1.55;
      border-top:1px solid rgba(120,255,240,.12);
      padding-top:14px;
    }
  </style>
</head>

<body>
  <div class="fx stars"></div>
  <div class="fx scanlines"></div>
  <div class="fx vignette"></div>

  <div class="wrap">
    <div class="topbar">
      <div class="brand">
        <div class="sig"></div>
        <div>
          <div style="display:flex; gap:10px; align-items:center; flex-wrap:wrap;">
            <div style="font-weight:900; letter-spacing:.12em;">OFF SCRIPT</div>
            <div class="chip">HUD</div>
            <div class="chip">PLAYER MAP</div>
          </div>
          <div style="font-size:12px; color:rgba(234,246,255,.62); letter-spacing:.06em;">
            scan → signature → loops → next move
          </div>
        </div>
      </div>

      <div style="display:flex; gap:10px; flex-wrap:wrap; justify-content:flex-end;">
        <a class="ghostBtn" href="index.html">← назад</a>
        <a class="btn" href="pricing.html">К ПРАЙСУ</a>
      </div>
    </div>

    <section class="hero" id="hero">
      <div class="heroGrid"></div>
      <div class="scanBeam"></div>

      <div class="heroInner">
        <div style="max-width: 760px;">
          <h1 class="glitch" data-text="SCAN COMPLETE">SCAN COMPLETE</h1>
          <div class="subline">
            <span class="badgeDot"></span>
            <span>OFF SCRIPT</span>
            <span style="opacity:.55;">•</span>
            <span>твоё текущее состояние</span>
          </div>

          <p class="lead" id="heroLead">
            <b>это не тест и не “описание личности”.</b><br>
            это HUD твоих решений: где ты управляешь, а где тебя ведёт сценарий.
          </p>

          <div class="hint">
            если где-то внутри стало неприятно — отлично. значит, ты увидел место, где тебя выключали.
          </div>
        </div>

        <div class="rightCol">
          <div class="chip"><b>ID</b>: <span class="mono" id="sid">—</span></div>
          <div class="chip"><b>DOB</b>: <span class="mono" id="sdob">—</span> <span id="stob"></span></div>
          <div class="chip"><b>TZ</b>: <span class="mono" id="stz">—</span></div>
          <div class="chip"><b>PLACE</b>: <span class="mono" id="splace">—</span></div>
        </div>
      </div>
    </section>

    <div class="grid">
      <!-- 1 -->
      <div class="card wide">
        <h3>ONE-LINER</h3>
        <div class="tag"><span class="dot"></span> быстрый диагноз</div>
        <div class="line mono" id="oneLiner">—</div>
        <div class="line" style="margin-top:10px; color:rgba(234,246,255,.76)" id="oneLinerSub">—</div>
      </div>

      <!-- 2 -->
      <div class="card">
        <h3>PLAYER STATUS</h3>
        <div class="tag"><span class="dot b"></span> где ты сейчас</div>
        <div class="line" id="statusText">—</div>
        <ul class="list" id="statusList"></ul>
      </div>

      <!-- 3 -->
      <div class="card">
        <h3>CORE</h3>
        <div class="tag"><span class="dot c"></span> твоя базовая логика</div>
        <div class="line" id="coreTitle">—</div>
        <ul class="list" id="coreList"></ul>
      </div>

      <!-- 4 -->
      <div class="card">
        <h3>LOOPS</h3>
        <div class="tag"><span class="dot d"></span> петли, которые крутят</div>
        <div class="line" id="loopsText">—</div>
        <ul class="list" id="loopsList"></ul>
      </div>

      <!-- 5 -->
      <div class="card">
        <h3>QUEST</h3>
        <div class="tag"><span class="dot"></span> твой повторяющийся квест</div>
        <div class="line" id="questText">—</div>
        <ul class="list" id="questList"></ul>
      </div>

      <!-- 6 -->
      <div class="card">
        <h3>ENERGY</h3>
        <div class="tag"><span class="dot b"></span> ресурс и утечки</div>
        <div class="line" id="energyText">—</div>
        <ul class="list" id="energyList"></ul>
      </div>

      <!-- 7 -->
      <div class="card">
        <h3>SETTINGS</h3>
        <div class="tag"><span class="dot c"></span> меню управления</div>
        <div class="line" id="controlText">—</div>
        <ul class="list" id="controlList"></ul>
      </div>

      <!-- 8 -->
      <div class="card wide">
        <h3>FULL ACCESS</h3>
        <div class="callout">
          <b>этот экран — обзор.</b> он показывает структуру, но не вскрывает её до причины.<br><br>
          <b>полный доступ</b> нужен, если ты хочешь:
          <ul class="list" style="margin-top:10px;">
            <li>понять, почему именно эти петли включаются у тебя</li>
            <li>увидеть точку, где ты отдаёшь управление (и как забрать)</li>
            <li>получить следующий ход, который даст сдвиг, а не “мотивацию на вечер”</li>
          </ul>
          <div class="line" style="margin-top:12px; color:rgba(234,246,255,.78)">
            без обещаний. без утешений. только разбор и точный ход.
          </div>
        </div>

        <div style="display:flex; gap:10px; flex-wrap:wrap; margin-top:12px; justify-content:flex-end;">
          <button class="ghostBtn" id="copyBtn" type="button">СКОПИРОВАТЬ ОТЧЁТ</button>
          <a class="btn" href="pricing.html">ОТКРЫТЬ ПРАЙС</a>
        </div>

        <div class="footer">
          OFF SCRIPT не является медицинской/психологической услугой. это интерфейс для ясности и выбора.
        </div>
      </div>
    </div>
  </div>

  <script>
    // ===== OFF SCRIPT — HUD ENGINE v1 =====
    function sumDigits(str){
      return String(str).replace(/\\D/g,'').split('').reduce((a,c)=>a+Number(c),0);
    }
    function reduceTo1to9(n){
      while(n>9){ n = String(n).split('').reduce((a,c)=>a+Number(c),0); }
      return n;
    }
    function pad2(n){ return String(n).padStart(2,'0'); }

    function readSession(){
      try{ return JSON.parse(localStorage.getItem("offscript_session") || "null"); }
      catch(e){ return null; }
    }

    // CORE SIGNATURE (1..9). Потом расширим под твою систему.
    const CORE = {
      1: {title:"ты не ищешь себя. ты хочешь право решать.", bullets:[
        "когда выбора нет — ты загораешься и давишь",
        "тебе нужен контроль над шагом, а не над людьми",
        "debuff: превращаешь контроль в броню"
      ]},
      2: {title:"ты чувствуешь людей. но иногда отдаёшь управление ради тишины.", bullets:[
        "ты ловишь контекст быстрее других",
        "debuff: уступаешь, чтобы не рушить связь",
        "если молчишь — копишь урон внутри"
      ]},
      3: {title:"тебе нужен голос и движение. иначе система гасит тебя.", bullets:[
        "ты оживаешь, когда выражаешься (текст/речь/дело)",
        "debuff: распыление и откладывание старта",
        "враг: самообесценивание"
      ]},
      4: {title:"ты строишь опору. даже когда делаешь вид, что живёшь без правил.", bullets:[
        "ты сильнее, когда правила выбраны тобой",
        "debuff: страх ошибки превращает тебя в бетон",
        "тебе нужен старт “пока криво”"
      ]},
      5: {title:"ты не нестабильный. ты не переносишь клетку.", bullets:[
        "тебе нужен воздух: смена, движение, риск",
        "debuff: ломать раньше, чем выбрать ход",
        "counter: свобода + дисциплина"
      ]},
      6: {title:"ты держишь качество. но спасательство ест твой ресурс.", bullets:[
        "ты умеешь улучшать и защищать",
        "debuff: брать чужое как своё",
        "counter: границы = щит"
      ]},
      7: {title:"ты видишь глубже. но если зависаешь в анализе — игра встаёт.", bullets:[
        "ты читаешь людей и ситуации как сканер",
        "debuff: изоляция и перфекционизм",
        "counter: шаг до готовности"
      ]},
      8: {title:"твой язык — ресурс и власть. не прячь его.", bullets:[
        "ты стратег, если играешь честно",
        "debuff: контроль ради безопасности",
        "тебе важно “на своих условиях”"
      ]},
      9: {title:"ты закрываешь циклы. но ты не обязана держать весь мир.", bullets:[
        "ты чувствуешь смысл и картину целиком",
        "debuff: выгорание от роли “тащить”",
        "counter: завершать и отпускать"
      ]},
    };

    function pickEntryMode(D){
      // как ты входишь в действие
      if(D <= 10) return {
        tag: "STALL", // стильный ярлык
        text: "ты зависаешь перед входом. не потому что слабый — потому что ждёшь идеальный момент.",
        bullets: [
          "ждёшь уверенность вместо шага",
          "не называешь условия — и тебя несёт",
          "сливаешь ход до старта"
        ]
      };
      if(D >= 21) return {
        tag: "OVERDRIVE",
        text: "ты входишь рывком. забираешь всё. и потом падаешь. сила есть — дозировки нет.",
        bullets: [
          "делаешь резко и до конца",
          "если не ты — никто",
          "конфликт включается быстрее диалога"
        ]
      };
      return {
        tag: "AUTO",
        text: "ты играешь ‘нормально’, но без острого выбора. привычка ведёт сильнее, чем желание.",
        bullets: [
          "готовишься дольше, чем делаешь",
          "сравнение жрёт ресурс",
          "решения откладываются ‘на потом’"
        ]
      };
    }

    function questByLifePath(lp){
      const Q = {
        1: ["квест: перестать доказывать — начать выбирать", "босс: зависимость от контроля"],
        2: ["квест: выйти из режима “удобно всем”", "босс: страх конфликта"],
        3: ["квест: говорить ясно, не прятать смысл", "босс: страх быть увиденным"],
        4: ["квест: строить свою систему, а не чужую", "босс: страх ошибки"],
        5: ["квест: свобода без самосноса", "босс: импульсивные решения"],
        6: ["квест: помогать без спасательства", "босс: вина"],
        7: ["квест: действовать, а не анализировать", "босс: изоляция"],
        8: ["квест: власть на своих условиях", "босс: контроль ради безопасности"],
        9: ["квест: завершать и не выгорать", "босс: роль спасателя"],
      };
      return Q[lp] || ["квест: выйти из сценария", "босс: автопилот"];
    }

    function energyByMonth(M){
      const E = {
        1:["regen: старт и движение","leak: ожидание","item: действие до сомнений"],
        2:["regen: доверие","leak: подавленный конфликт","item: честный разговор"],
        3:["regen: выражение","leak: самокритика","item: выпустить текст/голос"],
        4:["regen: порядок","leak: хаос","item: список 3 дел"],
        5:["regen: смена среды","leak: рутина","item: новый маршрут"],
        6:["regen: забота с границами","leak: спасательство","item: “нет” без объяснений"],
        7:["regen: тишина","leak: шум","item: 30 минут одиночества"],
        8:["regen: власть и масштаб","leak: чужие правила","item: один жёсткий выбор в день"],
        9:["regen: смысл","leak: суета","item: закрыть 1 хвост"],
        10:["regen: точность","leak: расплывчатость","item: правило на день"],
        11:["regen: видение","leak: сомнение","item: решение без обсуждений"],
        12:["regen: гибкость","leak: вина","item: отпустить одно “надо”"],
      };
      return E[M] || ["regen: движение","leak: сомнения","item: действие"];
    }

    function settingsPack(lp, entry){
      const list = [
        "command: один ручной выбор в день (без обсуждений)",
        "command: “я выбираю” — вслух или текстом",
        "rule: не торговаться с собой"
      ];
      if(lp === 8 || lp === 1){
        list.unshift("marker: у тебя высокий потенциал управления — вопрос, где ты его слил");
      }
      if(entry === "OVERDRIVE"){
        list.push("stop: не решай на эмоции. решай на фактах.");
      } else if(entry === "STALL"){
        list.push("start: сделай ход до уверенности.");
      } else {
        list.push("hack: поменяй одну привычку и смотри, что вскроется.");
      }
      return list;
    }

    function buildReport(session){
      const [Y,M,D] = session.dob.split("-").map(Number);
      const lp = reduceTo1to9(sumDigits(`${Y}${pad2(M)}${pad2(D)}`));
      const core = CORE[lp] || CORE[7];
      const entry = pickEntryMode(D);
      const quest = questByLifePath(lp);
      const energy = energyByMonth(M);

      // ONE-LINER: хлёстко, но без дешёвого унижения
      let one = "ты не ‘странный’. ты просто живёшь по сценарию, который когда-то помог выжить.";
      if(lp === 8) one = "ты умеешь управлять. но часть власти ты отдал — и теперь бесишься, а не выбираешь.";
      if(lp === 1) one = "тебе нужен контроль над выбором. когда его нет — ты превращаешься в огонь без цели.";
      if(lp === 5) one = "ты хочешь свободы. но иногда путаешь свободу с разрушением.";
      const oneSub = "узнал себя? отлично. значит, у тебя есть точка входа. дальше — выбор.";

      const statusText = "ты уже в игре. вопрос не “получится ли”. вопрос — кто сейчас держит управление.";
      const statusList = [
        `life code: ${lp} (core signature)`,
        `input mode: ${entry.tag}`,
        "цель карты: найти, где управление не у тебя"
      ];

      const loopsText = "это места, где ты повторяешь одно и то же — и называешь это “жизнью”.";
      const loopsList = entry.bullets;

      const questText = "это твоя тема. пока ты её не видишь — она видит тебя.";
      const questList = quest;

      const energyText = "ресурс уходит туда, где ты действуешь против себя. возвращается, когда играешь честно.";
      const energyList = energy;

      const controlText = "это меню управления. не советы. команды, которые возвращают доступ.";
      const controlList = settingsPack(lp, entry.tag);

      return {
        one, oneSub,
        statusText, statusList,
        core,
        loopsText, loopsList,
        questText, questList,
        energyText, energyList,
        controlText, controlList
      };
    }

    function el(id){ return document.getElementById(id); }
    function fillList(id, arr){
      const ul = el(id);
      ul.innerHTML = "";
      arr.forEach(x=>{
        const li = document.createElement("li");
        li.textContent = x;
        ul.appendChild(li);
      });
    }

    function makeId(dob, tob){
      const r = Math.random().toString(16).slice(2,6).toUpperCase();
      const base = dob.replaceAll('-','') + (tob ? tob.replace(':','') : 'XXXX');
      return "OS-" + base + "-" + r;
    }

    function init(){
      const s = readSession();
      if(!s){
        alert("данных нет. вернись на главную и нажми ENTER OFF SCRIPT.");
        window.location.href = "index.html";
        return;
      }

      // scan animation once
      const hero = document.getElementById("hero");
      hero.classList.add("scanning");
      setTimeout(()=> hero.classList.remove("scanning"), 2600);

      // show ids
      el("sid").textContent = s.id || makeId(s.dob, s.tob);
      el("sdob").textContent = s.dob || "—";
      el("stob").textContent = s.tob ? (" • " + s.tob) : "";
      el("stz").textContent = s.tz || "—";
      el("splace").textContent = s.place || "—";

      const r = buildReport(s);

      el("oneLiner").textContent = r.one;
      el("oneLinerSub").textContent = r.oneSub;

      el("statusText").textContent = r.statusText;
      fillList("statusList", r.statusList);

      el("coreTitle").textContent = r.core.title;
      fillList("coreList", r.core.bullets);

      el("loopsText").textContent = r.loopsText;
      fillList("loopsList", r.loopsList);

      el("questText").textContent = r.questText;
      fillList("questList", r.questList);

      el("energyText").textContent = r.energyText;
      fillList("energyList", r.energyList);

      el("controlText").textContent = r.controlText;
      fillList("controlList", r.controlList);

      // copy report (без разговоров про “сессии”)
      el("copyBtn").addEventListener("click", async ()=>{
        const txt =
`OFF SCRIPT — PLAYER MAP
ID: ${el("sid").textContent}
DOB: ${el("sdob").textContent}${s.tob ? (" " + s.tob) : ""} | TZ: ${el("stz").textContent} | PLACE: ${el("splace").textContent}
---
ONE-LINER:
${r.one}
${r.oneSub}

PLAYER STATUS:
- ${r.statusText}
${r.statusList.map(x=>"- "+x).join("\\n")}

CORE:
- ${r.core.title}
${r.core.bullets.map(x=>"- "+x).join("\\n")}

LOOPS:
- ${r.loopsText}
${r.loopsList.map(x=>"- "+x).join("\\n")}

QUEST:
- ${r.questText}
${r.questList.map(x=>"- "+x).join("\\n")}

ENERGY:
- ${r.energyText}
${r.energyList.map(x=>"- "+x).join("\\n")}

SETTINGS:
- ${r.controlText}
${r.controlList.map(x=>"- "+x).join("\\n")}
`;
        try{
          await navigator.clipboard.writeText(txt);
          alert("готово. отчёт в буфере.");
        }catch(e){
          const ta = document.createElement("textarea");
          ta.value = txt;
          document.body.appendChild(ta);
          ta.select();
          document.execCommand("copy");
          ta.remove();
          alert("готово. отчёт в буфере.");
        }
      });
    }

    init();
  </script>
</body>
</html>
